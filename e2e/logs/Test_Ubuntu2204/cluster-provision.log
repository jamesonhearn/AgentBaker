exit code: 0
----------------------------------- begin stderr -----------------------------------
+ echo 'sudo cat /var/log/azure/cluster-provision.log'
+ chmod 0755 script_file_8193a017-c9ad-42f7-83a0-24f54af5762d.sh
+ scp -i sshkey1022407 -o PasswordAuthentication=no -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -o ConnectTimeout=5 script_file_8193a017-c9ad-42f7-83a0-24f54af5762d.sh azureuser@10.224.0.7:script_file_8193a017-c9ad-42f7-83a0-24f54af5762d.sh
Warning: Permanently added '10.224.0.7' (ED25519) to the list of known hosts.

Authorized uses only. All activity may be monitored and reported.
+ ssh -i sshkey1022407 -o PasswordAuthentication=no -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -o ConnectTimeout=5 azureuser@10.224.0.7 bash script_file_8193a017-c9ad-42f7-83a0-24f54af5762d.sh
Warning: Permanently added '10.224.0.7' (ED25519) to the list of known hosts.

Authorized uses only. All activity may be monitored and reported.

------------------------------------ end stderr ------------------------------------
----------------------------------- begin stdout -----------------------------------,
+ '[' -f /opt/azure/containers/provision.complete ']'
++ seq 1 120
+ for i in $(seq 1 120)
+ '[' -s /opt/azure/containers/provision_source.sh ']'
+ grep -Fq '#HELPERSEOF' /opt/azure/containers/provision_source.sh
+ break
+ source /opt/azure/containers/provision_source.sh
++ ERR_SYSTEMCTL_START_FAIL=4
++ ERR_CLOUD_INIT_TIMEOUT=5
++ ERR_FILE_WATCH_TIMEOUT=6
++ ERR_HOLD_WALINUXAGENT=7
++ ERR_RELEASE_HOLD_WALINUXAGENT=8
++ ERR_APT_INSTALL_TIMEOUT=9
++ ERR_MISSING_CUDA_PACKAGE=10
++ ERR_DOCKER_INSTALL_TIMEOUT=20
++ ERR_DOCKER_DOWNLOAD_TIMEOUT=21
++ ERR_DOCKER_KEY_DOWNLOAD_TIMEOUT=22
++ ERR_DOCKER_APT_KEY_TIMEOUT=23
++ ERR_DOCKER_START_FAIL=24
++ ERR_MOBY_APT_LIST_TIMEOUT=25
++ ERR_MS_GPG_KEY_DOWNLOAD_TIMEOUT=26
++ ERR_MOBY_INSTALL_TIMEOUT=27
++ ERR_CONTAINERD_INSTALL_TIMEOUT=28
++ ERR_RUNC_INSTALL_TIMEOUT=29
++ ERR_K8S_RUNNING_TIMEOUT=30
++ ERR_K8S_DOWNLOAD_TIMEOUT=31
++ ERR_KUBECTL_NOT_FOUND=32
++ ERR_IMG_DOWNLOAD_TIMEOUT=33
++ ERR_KUBELET_START_FAIL=34
++ ERR_DOCKER_IMG_PULL_TIMEOUT=35
++ ERR_CONTAINERD_CTR_IMG_PULL_TIMEOUT=36
++ ERR_CONTAINERD_CRICTL_IMG_PULL_TIMEOUT=37
++ ERR_CONTAINERD_INSTALL_FILE_NOT_FOUND=38
++ ERR_CONTAINERD_VERSION_INVALID=39
++ ERR_CNI_DOWNLOAD_TIMEOUT=41
++ ERR_MS_PROD_DEB_DOWNLOAD_TIMEOUT=42
++ ERR_MS_PROD_DEB_PKG_ADD_FAIL=43
++ ERR_ORAS_DOWNLOAD_ERROR=45
++ ERR_SYSTEMD_INSTALL_FAIL=48
++ ERR_MODPROBE_FAIL=49
++ ERR_OUTBOUND_CONN_FAIL=50
++ ERR_K8S_API_SERVER_CONN_FAIL=51
++ ERR_K8S_API_SERVER_DNS_LOOKUP_FAIL=52
++ ERR_K8S_API_SERVER_AZURE_DNS_LOOKUP_FAIL=53
++ ERR_KATA_KEY_DOWNLOAD_TIMEOUT=60
++ ERR_KATA_APT_KEY_TIMEOUT=61
++ ERR_KATA_INSTALL_TIMEOUT=62
++ ERR_VHD_FILE_NOT_FOUND=65
++ ERR_CONTAINERD_DOWNLOAD_TIMEOUT=70
++ ERR_RUNC_DOWNLOAD_TIMEOUT=71
++ ERR_CUSTOM_SEARCH_DOMAINS_FAIL=80
++ ERR_GPU_DOWNLOAD_TIMEOUT=83
++ ERR_GPU_DRIVERS_START_FAIL=84
++ ERR_GPU_DRIVERS_INSTALL_TIMEOUT=85
++ ERR_GPU_DEVICE_PLUGIN_START_FAIL=86
++ ERR_GPU_INFO_ROM_CORRUPTED=87
++ ERR_SGX_DRIVERS_INSTALL_TIMEOUT=90
++ ERR_SGX_DRIVERS_START_FAIL=91
++ ERR_APT_DAILY_TIMEOUT=98
++ ERR_APT_UPDATE_TIMEOUT=99
++ ERR_CSE_PROVISION_SCRIPT_NOT_READY_TIMEOUT=100
++ ERR_APT_DIST_UPGRADE_TIMEOUT=101
++ ERR_APT_PURGE_FAIL=102
++ ERR_SYSCTL_RELOAD=103
++ ERR_CIS_ASSIGN_ROOT_PW=111
++ ERR_CIS_ASSIGN_FILE_PERMISSION=112
++ ERR_PACKER_COPY_FILE=113
++ ERR_CIS_APPLY_PASSWORD_CONFIG=115
++ ERR_SYSTEMD_DOCKER_STOP_FAIL=116
++ ERR_CRICTL_DOWNLOAD_TIMEOUT=117
++ ERR_CRICTL_OPERATION_ERROR=118
++ ERR_CTR_OPERATION_ERROR=119
++ ERR_INVALID_CLI_TOOL=120
++ ERR_KUBELET_INSTALL_FAIL=121
++ ERR_KUBECTL_INSTALL_FAIL=122
++ ERR_VHD_BUILD_ERROR=125
++ ERR_SWAP_CREATE_FAIL=130
++ ERR_SWAP_CREATE_INSUFFICIENT_DISK_SPACE=131
++ ERR_TELEPORTD_DOWNLOAD_ERR=150
++ ERR_TELEPORTD_INSTALL_ERR=151
++ ERR_ARTIFACT_STREAMING_DOWNLOAD=152
++ ERR_ARTIFACT_STREAMING_INSTALL=153
++ ERR_ARTIFACT_STREAMING_ACR_NODEMON_START_FAIL=154
++ ERR_HTTP_PROXY_CA_CONVERT=160
++ ERR_UPDATE_CA_CERTS=161
++ ERR_SECURE_TLS_BOOTSTRAP_CLIENT_DOWNLOAD_ERROR=169
++ ERR_DISBALE_IPTABLES=170
++ ERR_DISABLE_SSH=172
++ ERR_PRIMARY_NIC_IP_NOT_FOUND=173
++ ERR_INSERT_IMDS_RESTRICTION_RULE_INTO_MANGLE_TABLE=174
++ ERR_INSERT_IMDS_RESTRICTION_RULE_INTO_FILTER_TABLE=175
++ ERR_DELETE_IMDS_RESTRICTION_RULE_FROM_MANGLE_TABLE=176
++ ERR_DELETE_IMDS_RESTRICTION_RULE_FROM_FILTER_TABLE=177
++ ERR_CONFIG_PUBKEY_AUTH_SSH=178
++ ERR_VHD_REBOOT_REQUIRED=200
++ ERR_NO_PACKAGES_FOUND=201
++ ERR_SNAPSHOT_UPDATE_START_FAIL=202
++ ERR_PRIVATE_K8S_PKG_ERR=203
++ ERR_K8S_INSTALL_ERR=204
++ ERR_SYSTEMCTL_MASK_FAIL=2
++ ERR_CREDENTIAL_PROVIDER_DOWNLOAD_TIMEOUT=205
++ ERR_CNI_VERSION_INVALID=206
++ ERR_ORAS_PULL_K8S_FAIL=207
++ ERR_ORAS_PULL_CREDENTIAL_PROVIDER=208
++ ERR_ORAS_IMDS_TIMEOUT=210
++ ERR_ORAS_PULL_NETWORK_TIMEOUT=211
++ ERR_ORAS_PULL_UNAUTHORIZED=212
++ ERR_LOOKUP_DISABLE_KUBELET_SERVING_CERTIFICATE_ROTATION_TAG=213
++ ERR_CLEANUP_CONTAINER_IMAGES=214
++ ERR_DNS_HEALTH_FAIL=215
++ ERR_LOCALDNS_FAIL=216
++ ERR_LOCALDNS_COREFILE_NOTFOUND=217
++ ERR_LOCALDNS_SLICEFILE_NOTFOUND=218
++ ERR_LOCALDNS_BINARY_ERR=219
++ ERR_SECURE_TLS_BOOTSTRAP_START_FAILURE=220
++ ERR_CLOUD_INIT_FAILED=223
++ ERR_NVIDIA_DRIVER_INSTALL=224
++ ERR_NVIDIA_GPG_KEY_DOWNLOAD_TIMEOUT=225
++ ERR_NVIDIA_AZURELINUX_REPO_FILE_DOWNLOAD_TIMEOUT=226
++ ERR_MANAGED_NVIDIA_EXP_INSTALL_FAIL=227
++ ERR_NVIDIA_DCGM_FAIL=228
++ ERR_NVIDIA_DCGM_EXPORTER_FAIL=229
++ ERR_LOOKUP_ENABLE_MANAGED_GPU_EXPERIENCE_TAG=230
++ ERR_PULL_POD_INFRA_CONTAINER_IMAGE=225
++ find /etc -type f,l -name '*-release' -print -quit
++ grep -q .
+++ gawk 'match($0, /^(ID=(.*))$/, a) { print toupper(a[2]); exit }'
+++ sort -r /etc/lsb-release /etc/os-release
++ OS=UBUNTU
+++ tr -d '"'
+++ gawk 'match($0, /^(VERSION_ID=(.*))$/, a) { print toupper(a[2] a[3]); exit }'
+++ sort -r /etc/lsb-release /etc/os-release
++ OS_VERSION=22.04
+++ gawk 'match($0, /^(VARIANT_ID=(.*))$/, a) { print toupper(a[2]); exit }'
+++ tr -d '"'
+++ sort -r /etc/lsb-release /etc/os-release
++ OS_VARIANT=
++ UBUNTU_OS_NAME=UBUNTU
++ MARINER_OS_NAME=MARINER
++ MARINER_KATA_OS_NAME=MARINERKATA
++ AZURELINUX_KATA_OS_NAME=AZURELINUXKATA
++ AZURELINUX_OS_NAME=AZURELINUX
++ FLATCAR_OS_NAME=FLATCAR
++ AZURELINUX_OSGUARD_OS_VARIANT=OSGUARD
++ KUBECTL=/usr/local/bin/kubectl
++ DOCKER=/usr/bin/docker
++ export GPU_DV=580.95.05
++ GPU_DV=580.95.05
++ export GPU_DEST=/usr/local/nvidia
++ GPU_DEST=/usr/local/nvidia
++ export NVIDIA_DRIVER_IMAGE_SHA=20251021155213
++ NVIDIA_DRIVER_IMAGE_SHA=20251021155213
++ export NVIDIA_DRIVER_IMAGE_TAG=580.95.05-20251021155213
++ NVIDIA_DRIVER_IMAGE_TAG=580.95.05-20251021155213
++ export NVIDIA_GPU_DRIVER_TYPE=cuda
++ NVIDIA_GPU_DRIVER_TYPE=cuda
++ export NVIDIA_DRIVER_IMAGE=mcr.microsoft.com/aks/aks-gpu-cuda
++ NVIDIA_DRIVER_IMAGE=mcr.microsoft.com/aks/aks-gpu-cuda
++ export 'CTR_GPU_INSTALL_CMD=ctr -n k8s.io run --privileged --rm --net-host --with-ns pid:/proc/1/ns/pid --mount type=bind,src=/opt/gpu,dst=/mnt/gpu,options=rbind --mount type=bind,src=/opt/actions,dst=/mnt/actions,options=rbind'
++ CTR_GPU_INSTALL_CMD='ctr -n k8s.io run --privileged --rm --net-host --with-ns pid:/proc/1/ns/pid --mount type=bind,src=/opt/gpu,dst=/mnt/gpu,options=rbind --mount type=bind,src=/opt/actions,dst=/mnt/actions,options=rbind'
++ export 'DOCKER_GPU_INSTALL_CMD=docker run --privileged --net=host --pid=host -v /opt/gpu:/mnt/gpu -v /opt/actions:/mnt/actions --rm'
++ DOCKER_GPU_INSTALL_CMD='docker run --privileged --net=host --pid=host -v /opt/gpu:/mnt/gpu -v /opt/actions:/mnt/actions --rm'
++ APT_CACHE_DIR=/var/cache/apt/archives/
++ PERMANENT_CACHE_DIR=/root/aptcache/
++ EVENTS_LOGGING_DIR=/var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
++ CURL_OUTPUT=/tmp/curl_verbose.out
++ ORAS_OUTPUT=/tmp/oras_verbose.out
++ ORAS_REGISTRY_CONFIG_FILE=/etc/oras/config.yaml
++ AKS_AAD_SERVER_APP_ID=6dae42f8-4368-4678-94ff-3960e28e3630
++ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
+ source /opt/azure/containers/provision_source_distro.sh
++ echo 'Sourcing cse_helpers_distro.sh for Ubuntu'
Sourcing cse_helpers_distro.sh for Ubuntu
+ LOG_DIR=/var/log/azure/aks
+ mkdir -p /var/log/azure/aks
+ ln -s /var/log/azure/cluster-provision.log /var/log/azure/cluster-provision-cse-output.log /opt/azure/components.json /opt/azure/manifest.json /opt/azure/cloud-init-files.paved /opt/azure/vhd-install.complete /var/log/azure/aks/
+ python3 /opt/azure/containers/provision_redact_cloud_config.py --cloud-config-path /var/lib/cloud/instance/cloud-config.txt --output-path /var/log/azure/aks/cloud-config.txt
Dumping redacted cloud-config to: /var/log/azure/aks/cloud-config.txt
++ date
++ hostname
+ echo Wed Nov 12 21:55:18 UTC 2025,88t8-2025-11-12-ubuntu2204000000, startcustomscript
+ source /opt/azure/containers/provision_installs.sh
++ CC_SERVICE_IN_TMP=/opt/azure/containers/cc-proxy.service.in
++ CC_SOCKET_IN_TMP=/opt/azure/containers/cc-proxy.socket.in
++ CNI_CONFIG_DIR=/etc/cni/net.d
++ CNI_BIN_DIR=/opt/cni/bin
++ CNI_DOWNLOADS_DIR=/opt/cni/downloads
++ CRICTL_DOWNLOAD_DIR=/opt/crictl/downloads
++ CRICTL_BIN_DIR=/usr/local/bin
++ CONTAINERD_DOWNLOADS_DIR=/opt/containerd/downloads
++ RUNC_DOWNLOADS_DIR=/opt/runc/downloads
++ K8S_DOWNLOADS_DIR=/opt/kubernetes/downloads
++ K8S_PRIVATE_PACKAGES_CACHE_DIR=/opt/kubernetes/downloads/private-packages
++ K8S_REGISTRY_REPO=oss/binaries/kubernetes
+++ lsb_release -r -s
++ UBUNTU_RELEASE=22.04
+++ ls /etc/lsb-release /etc/os-release
+++ sort -r /etc/lsb-release /etc/os-release
+++ gawk 'match($0, /^(ID=(.*))$/, a) { print toupper(a[2]); exit }'
++ OS=UBUNTU
+++ ls /etc/lsb-release /etc/os-release
+++ sort -r /etc/lsb-release /etc/os-release
+++ tr -d '"'
+++ gawk 'match($0, /^(VARIANT_ID=(.*))$/, a) { print toupper(a[2]); exit }'
++ OS_VARIANT=
++ SECURE_TLS_BOOTSTRAP_CLIENT_DOWNLOAD_DIR=/opt/aks-secure-tls-bootstrap-client/downloads
++ SECURE_TLS_BOOTSTRAP_CLIENT_BIN_DIR=/usr/local/bin
++ TELEPORTD_PLUGIN_DOWNLOAD_DIR=/opt/teleportd/downloads
++ CREDENTIAL_PROVIDER_DOWNLOAD_DIR=/opt/credentialprovider/downloads
++ CREDENTIAL_PROVIDER_BIN_DIR=/var/lib/kubelet/credential-provider
++ TELEPORTD_PLUGIN_BIN_DIR=/usr/local/bin
++ MANIFEST_FILEPATH=/opt/azure/manifest.json
++ COMPONENTS_FILEPATH=/opt/azure/components.json
++ VHD_LOGS_FILEPATH=/opt/azure/vhd-install.complete
++ MAN_DB_AUTO_UPDATE_FLAG_FILEPATH=/var/lib/man-db/auto-update
++ CURL_OUTPUT=/tmp/curl_verbose.out
++ UBUNTU_OS_NAME=UBUNTU
++ MARINER_OS_NAME=MARINER
++ CPU_ARCH=
+ source /opt/azure/containers/provision_installs_distro.sh
+ source /opt/azure/containers/provision_configs.sh
+++ hostname
+++ tail -c 2
++ NODE_INDEX=0
+++ hostname
++ NODE_NAME=88t8-2025-11-12-ubuntu2204000000
++ AZURE_JSON_PATH=/etc/kubernetes/azure.json
++ AKS_CUSTOM_CLOUD_JSON_PATH=/etc/kubernetes/AzurePublicCloud.json
++ SECURE_TLS_BOOTSTRAPPING_DROP_IN=/etc/systemd/system/secure-tls-bootstrap.service.d/10-securetlsbootstrap.conf
++ LOCALDNS_CORE_FILE=/opt/azure/containers/localdns/localdns.corefile
++ LOCALDNS_COREFILE=/opt/azure/containers/localdns/localdns.corefile
++ LOCALDNS_SLICEFILE=/etc/systemd/system/localdns.slice
+ '[' '!' -f /opt/azure/containers/base_prep.complete ']'
+ basePrep
+ aptmarkWALinuxAgent hold
++ get_ubuntu_release
++ lsb_release -r -s
++ date
++ hostname
+ echo Wed Nov 12 21:55:18 UTC 2025,88t8-2025-11-12-ubuntu2204000000, startAptmarkWALinuxAgent hold
Wed Nov 12 21:55:18 UTC 2025,88t8-2025-11-12-ubuntu2204000000, startAptmarkWALinuxAgent hold
+ wait_for_apt_locks
+ fuser /var/lib/dpkg/lock /var/lib/apt/lists/lock /var/cache/apt/archives/lock /var/lib/dpkg/lock-frontend
+ retrycmd_if_failure 120 5 25 apt-mark hold walinuxagent
+ _retrycmd_internal 120 5 25 true apt-mark hold walinuxagent
+ local retries=120
+ shift
+ local waitSleep=5
+ shift
+ local timeoutVal=25
+ shift
+ local shouldLog=true
+ shift
+ cmdToRun=('apt-mark' 'hold' 'walinuxagent')
+ local cmdToRun
+ local exitStatus=0
++ seq 1 120
+ for i in $(seq 1 "$retries")
+ timeout 25 apt-mark hold walinuxagent
+ UBUNTU_RELEASE=22.04
+ '[' 22.04 = 16.04 ']'
+ '[' -n 'export NO_PROXY=localhost,127.0.0.1,168.63.129.16,169.254.169.254,10.0.0.0/16,agentbaker-agentbaker-e2e-t-8ecadf-c82d8251.hcp.eastus.azmk8s.io; ' ']'
+ eval export 'NO_PROXY=localhost,127.0.0.1,168.63.129.16,169.254.169.254,10.0.0.0/16,agentbaker-agentbaker-e2e-t-8ecadf-c82d8251.hcp.eastus.azmk8s.io;'
++ export NO_PROXY=localhost,127.0.0.1,168.63.129.16,169.254.169.254,10.0.0.0/16,agentbaker-agentbaker-e2e-t-8ecadf-c82d8251.hcp.eastus.azmk8s.io
++ NO_PROXY=localhost,127.0.0.1,168.63.129.16,169.254.169.254,10.0.0.0/16,agentbaker-agentbaker-e2e-t-8ecadf-c82d8251.hcp.eastus.azmk8s.io
+ resolve_packages_source_url
+ local retries=5
+ local wait_sleep=1
+ PACKAGE_DOWNLOAD_BASE_URL=packages.aks.azure.com
++ seq 1 5
+ for i in $(seq 1 $retries)
++ curl -s -o /dev/null -w '%{http_code}' --max-time 5 https://packages.aks.azure.com/acs-mirror/healthz
+ response_code=200
+ '[' 200 -eq 200 ']'
+ echo 'Established connectivity to packages.aks.azure.com.'
Established connectivity to packages.aks.azure.com.
+ break
+ logs_to_events AKS.CSE.setPackagesBaseURL 'echo packages.aks.azure.com'
+ local task=AKS.CSE.setPackagesBaseURL
+ shift
++ date +%s%3N
+ local eventsFileName=1762984518383
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:18.384'
+ echo packages.aks.azure.com
packages.aks.azure.com
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:18.385'
++ jq -n --arg Timestamp '2025-11-12 21:55:18.384' --arg OperationId '2025-11-12 21:55:18.385' --arg Version 1.23 --arg TaskName AKS.CSE.setPackagesBaseURL --arg EventLevel Informational --arg Message 'Completed: echo packages.aks.azure.com' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:18.384",
  "OperationId": "2025-11-12 21:55:18.385",
  "Version": "1.23",
  "TaskName": "AKS.CSE.setPackagesBaseURL",
  "EventLevel": "Informational",
  "Message": "Completed: echo packages.aks.azure.com",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:18.384",' '"OperationId":' '"2025-11-12' '21:55:18.385",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.setPackagesBaseURL",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' echo 'packages.aks.azure.com",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ logs_to_events AKS.CSE.configureAzureJson configureAzureJson
+ local task=AKS.CSE.configureAzureJson
+ shift
++ date +%s%3N
+ local eventsFileName=1762984518400
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:18.401'
+ configureAzureJson
++ dirname /etc/kubernetes/azure.json
+ mkdir -p /etc/kubernetes
+ touch /etc/kubernetes/azure.json
+ chmod 0600 /etc/kubernetes/azure.json
+ chown root:root /etc/kubernetes/azure.json
+ set +x
+ '[' v2 = v2 ']'
+ sed -i /cloudProviderBackoffExponent/d /etc/kubernetes/azure.json
+ sed -i /cloudProviderBackoffJitter/d /etc/kubernetes/azure.json
+ '[' false = true ']'
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:18.427'
++ jq -n --arg Timestamp '2025-11-12 21:55:18.401' --arg OperationId '2025-11-12 21:55:18.427' --arg Version 1.23 --arg TaskName AKS.CSE.configureAzureJson --arg EventLevel Informational --arg Message 'Completed: configureAzureJson' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:18.401",
  "OperationId": "2025-11-12 21:55:18.427",
  "Version": "1.23",
  "TaskName": "AKS.CSE.configureAzureJson",
  "EventLevel": "Informational",
  "Message": "Completed: configureAzureJson",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:18.401",' '"OperationId":' '"2025-11-12' '21:55:18.427",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.configureAzureJson",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'configureAzureJson",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ logs_to_events AKS.CSE.ensureKubeCACert ensureKubeCACert
+ local task=AKS.CSE.ensureKubeCACert
+ shift
++ date +%s%3N
+ local eventsFileName=1762984518443
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:18.444'
+ ensureKubeCACert
+ KUBE_CA_FILE=/etc/kubernetes/certs/ca.crt
++ dirname /etc/kubernetes/certs/ca.crt
+ mkdir -p /etc/kubernetes/certs
+ echo LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUU2RENDQXRDZ0F3SUJBZ0lRWU5YK3RDaHcyc1pNNjBMenBlTGZmREFOQmdrcWhraUc5dzBCQVFzRkFEQU4KTVFzd0NRWURWUVFERXdKallUQWdGdzB5TlRFeE1URXdNVEUwTWpoYUdBOHlNRFUxTVRFeE1UQXhNalF5T0ZvdwpEVEVMTUFrR0ExVUVBeE1DWTJFd2dnSWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUNEd0F3Z2dJS0FvSUNBUUMyCm5jeWZ1bHd5Q2w2TnhFRnZlZEhVQ0dBeWhCRGhNM3RyK0YwWG5YeVdGREg3eHhKbTVzTzZXTkQyMHhpNkNKMUgKb3dKYlJ4aFZTMTRvU2FTTjJRQXExNVlqRU9BYjlEODlPRmxwM0hRQ09NVEsrbUhFL3h6TlRqNVhtNVV4NUFKKwpoWEd6WEZEUEp2YXBxK0dlc3Vwem1ibTVnR1k2eWN1YTA4R2c5MkdyejdnZUEvTEpDay9qblU5VWg4TnZDKzQxClN4czJDVU5uWlAxY2s3VWNmdU9LZVJ0K3oyUjRQVWxuTEJkdVdjazVQQ3hmbVZaUXpHa1VKbWZVZGpPKzJvdG0KWGp4aHBuc0ZhVGtHTnhjYms3a1YySTMrYkM3aC9HSFBCYldrbDVpRUlHQUVuNm5WSmJqNkpSdjFnb2dOQi9VRgo1WmpKZkNtdC9xQk1JWWs0Wk1vU0MxbGVaSDFlbDJPNkRYRXlHZFhINFo4REtVejZyZnYzR1VkbTZSNUMxMHhPClJQS0UzSCs2bUF6cHhBdFpKNHYrdWRrakthQ0Y0eEp4L251L2w5NU4wTEdLbktzaTBTckpQWG5YeDRzZnpIc24KS253L0RlNkIycHdHbFR4cXRKUHJTcmdpWjI3elpkN21uZnVIdjJxMHNmZjhtcjhrcmdjclNBdStzOVhTYW8wQQpDQUNBMDd6ZkNVTS9qY2gwZ2tyNkt2bWd4OG05MXlIMmFSQXVjQ0dwcXpwOVZWbGRKb0F4aDdMaUdyTDZGNTI5CkNlNlBRaDM1QjZUd1VBa1FCTkdwRm1yR2VONzFyMWdFQVYwS2Y2YUQrN0xIOGFFa3pZSkg5eHlTaHVqRzlkU3UKekRMRDRwR2NSaUpaSHJQVUxrMHpkQ3dIS0ZUbjliR1VvZlFCdkVkSWtRSURBUUFCbzBJd1FEQU9CZ05WSFE4QgpBZjhFQkFNQ0FxUXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVVIaDZKRXk0c1I5b3J5a2FoCks5QTBqQ1cvalM0d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dJQkFBUTRSZ1ZGZjcrT3JwcjA4T1U5T1Axb2kxa20KYWNkdkVNWVNMeWFmZThObW04R0tUM3oyQStGT0RreWFwVVhkS2s2OW5OQ0dIdXo2RWM2OGlIdkhqZ1NoZnRkcwpsbkNuR3lhcWRHWE5hZnd3eDdDKy9nMEJ1S205SzJ1L052cktjN01Mdy9HRWtEZ0MrcHV5VG5mb1pGWXdxT3hICnl0ZDMvMjFpR2VSSXFUV1FxMklFV25NdjlrbG9xN3V1ZWxyQllvT1ZhcTUzeU9iRnVnOThQY3l1Z3NBWjVFWDAKdWNqUDdSaDNVMDhxZm90ZjlDM2pVeUYvTVN3VVFIc3NOUDVubVE5ZzFGNHBFQ2IyN0VLOWVuQmVtTStsTUp3UQpHR3k2Q3pscktaZWFvVCtXZEtBTWFyTnJiMWdEZ2ttTDg0d21TUC9MTUxJQWU4UDJTL2JsYXpqbTVaWngxYXhTCjhZbU9qOFFrK2tnclYzSkg2Y0NJOVBjRGhRZVVqdFVUeDlMNXVtNWJUY1c5MW01bklEd2lxRURDUURuNnY1dUIKWCt2RHhjbWM2TWpiNlg5M1prSmgyb3dsRms3b3ZYYUlwZDBySmFvTnZPZm9vTW00M1F0V2hwTVZOZ0g5UGtDcgpEZTVKZG13Y29GRVZVZ2RxWHAyZWo3RHBQdVE0UExzUXovbjhjd0pHYUV5Z3NnQWZQZGtHaE9oVUF3OCsyb1NtCmZ5LzE4ZVBQRW0wNmoxeXduanBxODYycVdJaXFuWE1pT0gzSEVSWTVNeXp6MG9qRENqRFZEUjIyQ2p6SEtmZGUKY0F4d09ncFZNa3N3T2hiMHNPZXowVlYwZEJyN05qRVdrRFJabDlDZ3lpZWNQVHRQbG02YXpGdWIrOUNSL1Y0egovSStzQ3hwSjJIYlh0L3VGCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
+ base64 -d
+ chmod 0600 /etc/kubernetes/certs/ca.crt
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:18.451'
++ jq -n --arg Timestamp '2025-11-12 21:55:18.444' --arg OperationId '2025-11-12 21:55:18.451' --arg Version 1.23 --arg TaskName AKS.CSE.ensureKubeCACert --arg EventLevel Informational --arg Message 'Completed: ensureKubeCACert' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:18.444",
  "OperationId": "2025-11-12 21:55:18.451",
  "Version": "1.23",
  "TaskName": "AKS.CSE.ensureKubeCACert",
  "EventLevel": "Informational",
  "Message": "Completed: ensureKubeCACert",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:18.444",' '"OperationId":' '"2025-11-12' '21:55:18.451",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.ensureKubeCACert",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'ensureKubeCACert",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ logs_to_events AKS.CSE.installSecureTLSBootstrapClient installSecureTLSBootstrapClient
+ local task=AKS.CSE.installSecureTLSBootstrapClient
+ shift
++ date +%s%3N
+ local eventsFileName=1762984518469
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:18.470'
+ installSecureTLSBootstrapClient
+ '[' false '!=' true ']'
+ echo 'secure TLS bootstrapping is disabled, will remove secure TLS bootstrap client binary installation'
secure TLS bootstrapping is disabled, will remove secure TLS bootstrap client binary installation
+ rm -f /usr/local/bin/aks-secure-tls-bootstrap-client
+ return 0
+ ret=0
++ date '+%F %T.%3N'
+ rm -rf /opt/aks-secure-tls-bootstrap-client/downloads
+ local 'endTime=2025-11-12 21:55:18.472'
++ jq -n --arg Timestamp '2025-11-12 21:55:18.470' --arg OperationId '2025-11-12 21:55:18.472' --arg Version 1.23 --arg TaskName AKS.CSE.installSecureTLSBootstrapClient --arg EventLevel Informational --arg Message 'Completed: installSecureTLSBootstrapClient' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:18.470",
  "OperationId": "2025-11-12 21:55:18.472",
  "Version": "1.23",
  "TaskName": "AKS.CSE.installSecureTLSBootstrapClient",
  "EventLevel": "Informational",
  "Message": "Completed: installSecureTLSBootstrapClient",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:18.470",' '"OperationId":' '"2025-11-12' '21:55:18.472",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.installSecureTLSBootstrapClient",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'installSecureTLSBootstrapClient",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ logs_to_events AKS.CSE.configureSSHPubkeyAuth configureSSHPubkeyAuth false
+ local task=AKS.CSE.configureSSHPubkeyAuth
+ shift
++ date +%s%3N
+ local eventsFileName=1762984518490
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:18.492'
+ configureSSHPubkeyAuth false
+ local disable_pubkey_auth=false
+ local ssh_use_pubkey_auth
+ '[' false = true ']'
+ ssh_use_pubkey_auth=yes
+ local SSHD_CONFIG=/etc/ssh/sshd_config
+ local TMP
++ mktemp
+ TMP=/tmp/tmp.IMefxgdGSS
+ awk -v desired=yes '
    BEGIN { in_match=0; replaced=0; inserted=0 }
    /^Match([[:space:]]|$)/ {
      if (!replaced && !inserted) { print "PubkeyAuthentication " desired; inserted=1 }
      in_match=1; print; next
    }
    (!in_match) && /^[[:space:]]*PubkeyAuthentication[[:space:]]+/ {
      print "PubkeyAuthentication " desired; replaced=1; next
    }
    { print }
    END { if (!replaced && !inserted) print "PubkeyAuthentication " desired }
  ' /etc/ssh/sshd_config
+ sudo sshd -t -f /tmp/tmp.IMefxgdGSS
+ sudo install -m 644 -o root -g root /tmp/tmp.IMefxgdGSS /etc/ssh/sshd_config
+ rm -f /tmp/tmp.IMefxgdGSS
+ sudo systemctl reload sshd
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:19.019'
++ jq -n --arg Timestamp '2025-11-12 21:55:18.492' --arg OperationId '2025-11-12 21:55:19.019' --arg Version 1.23 --arg TaskName AKS.CSE.configureSSHPubkeyAuth --arg EventLevel Informational --arg Message 'Completed: configureSSHPubkeyAuth false' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:18.492",
  "OperationId": "2025-11-12 21:55:19.019",
  "Version": "1.23",
  "TaskName": "AKS.CSE.configureSSHPubkeyAuth",
  "EventLevel": "Informational",
  "Message": "Completed: configureSSHPubkeyAuth false",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:18.492",' '"OperationId":' '"2025-11-12' '21:55:19.019",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.configureSSHPubkeyAuth",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' configureSSHPubkeyAuth 'false",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ '[' false = true ']'
+ echo 'private egress proxy address is '\'''\'''
private egress proxy address is ''
+ '[' false = true ']'
+ '[' false = true ']'
+ logs_to_events AKS.CSE.setCPUArch setCPUArch
+ local task=AKS.CSE.setCPUArch
+ shift
++ date +%s%3N
+ local eventsFileName=1762984519039
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:19.040'
+ setCPUArch
++ getCPUArch
+++ uname -m
++ arch=x86_64
++ [[ x86_64 == \a\a\r\c\h\6\4 ]]
++ [[ x86_64 == \a\r\m\6\4 ]]
++ echo amd64
+ CPU_ARCH=amd64
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:19.044'
++ jq -n --arg Timestamp '2025-11-12 21:55:19.040' --arg OperationId '2025-11-12 21:55:19.044' --arg Version 1.23 --arg TaskName AKS.CSE.setCPUArch --arg EventLevel Informational --arg Message 'Completed: setCPUArch' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:19.040",
  "OperationId": "2025-11-12 21:55:19.044",
  "Version": "1.23",
  "TaskName": "AKS.CSE.setCPUArch",
  "EventLevel": "Informational",
  "Message": "Completed: setCPUArch",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:19.040",' '"OperationId":' '"2025-11-12' '21:55:19.044",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.setCPUArch",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'setCPUArch",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ source /etc/os-release
++ PRETTY_NAME='Ubuntu 22.04.5 LTS'
++ NAME=Ubuntu
++ VERSION_ID=22.04
++ VERSION='22.04.5 LTS (Jammy Jellyfish)'
++ VERSION_CODENAME=jammy
++ ID=ubuntu
++ ID_LIKE=debian
++ HOME_URL=https://www.ubuntu.com/
++ SUPPORT_URL=https://help.ubuntu.com/
++ BUG_REPORT_URL=https://bugs.launchpad.net/ubuntu/
++ PRIVACY_POLICY_URL=https://www.ubuntu.com/legal/terms-and-policies/privacy-policy
++ UBUNTU_CODENAME=jammy
+ '[' ubuntu '!=' mariner ']'
+ '[' ubuntu '!=' azurelinux ']'
+ echo 'Removing man-db auto-update flag file...'
Removing man-db auto-update flag file...
+ logs_to_events AKS.CSE.removeManDbAutoUpdateFlagFile removeManDbAutoUpdateFlagFile
+ local task=AKS.CSE.removeManDbAutoUpdateFlagFile
+ shift
++ date +%s%3N
+ local eventsFileName=1762984519061
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:19.063'
+ removeManDbAutoUpdateFlagFile
+ rm -f /var/lib/man-db/auto-update
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:19.065'
++ jq -n --arg Timestamp '2025-11-12 21:55:19.063' --arg OperationId '2025-11-12 21:55:19.065' --arg Version 1.23 --arg TaskName AKS.CSE.removeManDbAutoUpdateFlagFile --arg EventLevel Informational --arg Message 'Completed: removeManDbAutoUpdateFlagFile' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:19.063",
  "OperationId": "2025-11-12 21:55:19.065",
  "Version": "1.23",
  "TaskName": "AKS.CSE.removeManDbAutoUpdateFlagFile",
  "EventLevel": "Informational",
  "Message": "Completed: removeManDbAutoUpdateFlagFile",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:19.063",' '"OperationId":' '"2025-11-12' '21:55:19.065",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.removeManDbAutoUpdateFlagFile",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'removeManDbAutoUpdateFlagFile",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ '[' -n '' ']'
+ logs_to_events AKS.CSE.disableSystemdResolved disableSystemdResolved
+ local task=AKS.CSE.disableSystemdResolved
+ shift
++ date +%s%3N
+ local eventsFileName=1762984519083
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:19.085'
+ disableSystemdResolved
+ ls -ltr /etc/resolv.conf
lrwxrwxrwx 1 root root 39 Oct 23 07:48 /etc/resolv.conf -> ../run/systemd/resolve/stub-resolv.conf
+ cat /etc/resolv.conf
# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).
# Do not edit.
#
# This file might be symlinked as /etc/resolv.conf. If you're looking at
# /etc/resolv.conf and seeing this text, you have followed the symlink.
#
# This is a dynamic resolv.conf file for connecting local clients to the
# internal DNS stub resolver of systemd-resolved. This file lists all
# configured search domains.
#
# Run "resolvectl status" to see details about the uplink DNS servers
# currently in use.
#
# Third party programs should typically not access this file directly, but only
# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
# different way, replace this symlink by a static file or a different symlink.
#
# See man:systemd-resolved.service(8) for details about the supported modes of
# operation for /etc/resolv.conf.

nameserver 127.0.0.53
options edns0 trust-ad
search axskqyvniysezc55ckz0zjwole.xx.internal.cloudapp.net
++ lsb_release -r -s
+ UBUNTU_RELEASE=22.04
+ '[' 22.04 = 18.04 ']'
+ '[' 22.04 = 20.04 ']'
+ '[' 22.04 = 22.04 ']'
+ echo 'Ingoring systemd-resolved query service but using its resolv.conf file'
Ingoring systemd-resolved query service but using its resolv.conf file
+ echo 'This is the simplest approach to workaround resolved issues without completely uninstall it'
This is the simplest approach to workaround resolved issues without completely uninstall it
+ '[' -f /run/systemd/resolve/resolv.conf ']'
+ sudo ln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf
+ ls -ltr /etc/resolv.conf
lrwxrwxrwx 1 root root 32 Nov 12 21:55 /etc/resolv.conf -> /run/systemd/resolve/resolv.conf
+ cat /etc/resolv.conf
# This is /run/systemd/resolve/resolv.conf managed by man:systemd-resolved(8).
# Do not edit.
#
# This file might be symlinked as /etc/resolv.conf. If you're looking at
# /etc/resolv.conf and seeing this text, you have followed the symlink.
#
# This is a dynamic resolv.conf file for connecting local clients directly to
# all known uplink DNS servers. This file lists all configured search domains.
#
# Third party programs should typically not access this file directly, but only
# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
# different way, replace this symlink by a static file or a different symlink.
#
# See man:systemd-resolved.service(8) for details about the supported modes of
# operation for /etc/resolv.conf.

nameserver 168.63.129.16
search axskqyvniysezc55ckz0zjwole.xx.internal.cloudapp.net
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:19.126'
++ jq -n --arg Timestamp '2025-11-12 21:55:19.085' --arg OperationId '2025-11-12 21:55:19.126' --arg Version 1.23 --arg TaskName AKS.CSE.disableSystemdResolved --arg EventLevel Informational --arg Message 'Completed: disableSystemdResolved' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:19.085",
  "OperationId": "2025-11-12 21:55:19.126",
  "Version": "1.23",
  "TaskName": "AKS.CSE.disableSystemdResolved",
  "EventLevel": "Informational",
  "Message": "Completed: disableSystemdResolved",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:19.085",' '"OperationId":' '"2025-11-12' '21:55:19.126",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.disableSystemdResolved",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'disableSystemdResolved",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ logs_to_events AKS.CSE.configureAdminUser configureAdminUser
+ local task=AKS.CSE.configureAdminUser
+ shift
++ date +%s%3N
+ local eventsFileName=1762984519145
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:19.146'
+ configureAdminUser
+ chage -E -1 -I -1 -m 0 -M 99999 azureuser
+ chage -l azureuser
Last password change					: Nov 12, 2025
Password expires					: never
Password inactive					: never
Account expires						: never
Minimum number of days between password change		: 0
Maximum number of days between password change		: 99999
Number of days of warning before password expires	: 7
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:19.161'
++ jq -n --arg Timestamp '2025-11-12 21:55:19.146' --arg OperationId '2025-11-12 21:55:19.161' --arg Version 1.23 --arg TaskName AKS.CSE.configureAdminUser --arg EventLevel Informational --arg Message 'Completed: configureAdminUser' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:19.146",
  "OperationId": "2025-11-12 21:55:19.161",
  "Version": "1.23",
  "TaskName": "AKS.CSE.configureAdminUser",
  "EventLevel": "Informational",
  "Message": "Completed: configureAdminUser",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:19.146",' '"OperationId":' '"2025-11-12' '21:55:19.161",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.configureAdminUser",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'configureAdminUser",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ export -f getInstallModeAndCleanupContainerImages
+ export -f should_skip_binary_cleanup
++ retrycmd_silent 10 1 10 bash -cx should_skip_binary_cleanup
++ _retrycmd_internal 10 1 10 false bash -cx should_skip_binary_cleanup
++ local retries=10
++ shift
++ local waitSleep=1
++ shift
++ local timeoutVal=10
++ shift
++ local shouldLog=false
++ shift
++ cmdToRun=('bash' '-cx' 'should_skip_binary_cleanup')
++ local cmdToRun
++ local exitStatus=0
+++ seq 1 10
++ for i in $(seq 1 "$retries")
++ timeout 10 bash -cx should_skip_binary_cleanup
+ should_skip_binary_cleanup
+ set -x
++ curl -fsSL -H 'Metadata: true' --noproxy '*' 'http://169.254.169.254/metadata/instance?api-version=2021-02-01'
+ body='{"compute":{"azEnvironment":"AzurePublicCloud","customData":"","evictionPolicy":"","isHostCompatibilityLayerVm":"false","licenseType":"","location":"westus2","name":"88t8-2025-11-12-ubuntu2204_0","offer":"","osProfile":{"adminUsername":"azureuser","computerName":"88t8-2025-11-12-ubuntu2204000000","disablePasswordAuthentication":"true"},"osType":"Linux","placementGroupId":"c61ccfee-96ef-40f5-a960-3f4b85676bcb","plan":{"name":"","product":"","publisher":""},"platformFaultDomain":"0","platformUpdateDomain":"0","priority":"","provider":"Microsoft.Compute","publicKeys":[{"keyData":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC8i1dJi2pq3jYOaEYIJnM4/Lggs7Sa26Q3aAWy8GRB3qJUzINbkOJgOMWGnN2mnRHJTKqBKttXs8A8NCoUE1FwNve70gfGnoo1tLjF/hkaITsAfDm0+Clk6p4a26SkbjqdkHexNrcbn4JqY6EJqLvYd7PtjSREB+Ky+IJghdHem5RJxSs4/MrbvcNe2hPJgF9vcTJfjiLbGsR1cwWg0pBdlIY73BJnWdNlHrpCoxlYgnb8OJuqGv3vjw9RKCBfa/rzh4qZuR4L0SrFX+Pu3OS1aRT/Z5PS1Nwg8rW7NC+E9rsL0+yBt1+7qUrLxU4arq/vyqAxH+DCa+Qvu174BAkYVyA4y2BmLI2Wdw6qgRmtjZTJcH2zXCYRx1L1qp7FngXCDNDE1diDKSdazv9/YQNyIwxzqAKU5bsWM7Lo72mDiae1r8z61tfHFOMAQi/Hkz5RFbwt/4gjQGadxf2x7b7sMGSeqFjXxPvTf2ylVyll0113j3jEL6ho5GvlKPsftvlT7ClrV0cCquZkZ3pZYDX7TE1zlnvkLloh/Iir/Uq6KacPc4Y3kKTK6hRpXVCbzwlapHFHQXGqvZ12EjIfp9WpF1YXLVrStoM3DCpCeqLn11gsTF/6v9Z0ZaYsSrQuBxqFefDNoA7B7djm5wdOHOfXsT/ygXooBW660s4GeKfDTw==\n","path":"/home/azureuser/.ssh/authorized_keys"}],"publisher":"","resourceGroupName":"MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2","resourceId":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/virtualMachineScaleSets/88t8-2025-11-12-ubuntu2204/virtualMachines/0","securityProfile":{"secureBootEnabled":"false","virtualTpmEnabled":"false"},"sku":"","storageProfile":{"dataDisks":[],"imageReference":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/packer/providers/Microsoft.Compute/galleries/akse2esig/images/aks-ubuntu-containerd-22.04-gen2/versions/1.1762806891.5705","offer":"","publisher":"","sku":"","version":""},"osDisk":{"caching":"ReadOnly","createOption":"FromImage","diffDiskSettings":{"option":"Local"},"diskSizeGB":"50","encryptionSettings":{"enabled":"false"},"image":{"uri":""},"managedDisk":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/disks/88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","storageAccountType":"Standard_LRS"},"name":"88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","osType":"Linux","vhd":{"uri":""},"writeAcceleratorEnabled":"false"},"resourceDisk":{"size":"0"}},"subscriptionId":"0660fddc-d191-4bad-b922-e69492903e0a","tags":"KEEP_VMSS:true;buildID:local;owner:e2e","tagsList":[{"name":"KEEP_VMSS","value":"true"},{"name":"buildID","value":"local"},{"name":"owner","value":"e2e"}],"userData":"","version":"1.1762806891.5705","vmId":"8b8bafc0-8aec-4bde-9f61-7069689d3ea6","vmScaleSetName":"88t8-2025-11-12-ubuntu2204","vmSize":"Standard_D2ads_v6","zone":""},"network":{"interface":[{"ipv4":{"ipAddress":[{"privateIpAddress":"10.224.0.7","publicIpAddress":""}],"subnet":[{"address":"10.224.0.0","prefix":"16"}]},"ipv6":{"ipAddress":[]},"macAddress":"000D3AFE890C"}]}}'
+ ret=0
+ '[' 0 -ne 0 ']'
++ echo '{"compute":{"azEnvironment":"AzurePublicCloud","customData":"","evictionPolicy":"","isHostCompatibilityLayerVm":"false","licenseType":"","location":"westus2","name":"88t8-2025-11-12-ubuntu2204_0","offer":"","osProfile":{"adminUsername":"azureuser","computerName":"88t8-2025-11-12-ubuntu2204000000","disablePasswordAuthentication":"true"},"osType":"Linux","placementGroupId":"c61ccfee-96ef-40f5-a960-3f4b85676bcb","plan":{"name":"","product":"","publisher":""},"platformFaultDomain":"0","platformUpdateDomain":"0","priority":"","provider":"Microsoft.Compute","publicKeys":[{"keyData":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC8i1dJi2pq3jYOaEYIJnM4/Lggs7Sa26Q3aAWy8GRB3qJUzINbkOJgOMWGnN2mnRHJTKqBKttXs8A8NCoUE1FwNve70gfGnoo1tLjF/hkaITsAfDm0+Clk6p4a26SkbjqdkHexNrcbn4JqY6EJqLvYd7PtjSREB+Ky+IJghdHem5RJxSs4/MrbvcNe2hPJgF9vcTJfjiLbGsR1cwWg0pBdlIY73BJnWdNlHrpCoxlYgnb8OJuqGv3vjw9RKCBfa/rzh4qZuR4L0SrFX+Pu3OS1aRT/Z5PS1Nwg8rW7NC+E9rsL0+yBt1+7qUrLxU4arq/vyqAxH+DCa+Qvu174BAkYVyA4y2BmLI2Wdw6qgRmtjZTJcH2zXCYRx1L1qp7FngXCDNDE1diDKSdazv9/YQNyIwxzqAKU5bsWM7Lo72mDiae1r8z61tfHFOMAQi/Hkz5RFbwt/4gjQGadxf2x7b7sMGSeqFjXxPvTf2ylVyll0113j3jEL6ho5GvlKPsftvlT7ClrV0cCquZkZ3pZYDX7TE1zlnvkLloh/Iir/Uq6KacPc4Y3kKTK6hRpXVCbzwlapHFHQXGqvZ12EjIfp9WpF1YXLVrStoM3DCpCeqLn11gsTF/6v9Z0ZaYsSrQuBxqFefDNoA7B7djm5wdOHOfXsT/ygXooBW660s4GeKfDTw==\n","path":"/home/azureuser/.ssh/authorized_keys"}],"publisher":"","resourceGroupName":"MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2","resourceId":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/virtualMachineScaleSets/88t8-2025-11-12-ubuntu2204/virtualMachines/0","securityProfile":{"secureBootEnabled":"false","virtualTpmEnabled":"false"},"sku":"","storageProfile":{"dataDisks":[],"imageReference":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/packer/providers/Microsoft.Compute/galleries/akse2esig/images/aks-ubuntu-containerd-22.04-gen2/versions/1.1762806891.5705","offer":"","publisher":"","sku":"","version":""},"osDisk":{"caching":"ReadOnly","createOption":"FromImage","diffDiskSettings":{"option":"Local"},"diskSizeGB":"50","encryptionSettings":{"enabled":"false"},"image":{"uri":""},"managedDisk":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/disks/88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","storageAccountType":"Standard_LRS"},"name":"88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","osType":"Linux","vhd":{"uri":""},"writeAcceleratorEnabled":"false"},"resourceDisk":{"size":"0"}},"subscriptionId":"0660fddc-d191-4bad-b922-e69492903e0a","tags":"KEEP_VMSS:true;buildID:local;owner:e2e","tagsList":[{"name":"KEEP_VMSS","value":"true"},{"name":"buildID","value":"local"},{"name":"owner","value":"e2e"}],"userData":"","version":"1.1762806891.5705","vmId":"8b8bafc0-8aec-4bde-9f61-7069689d3ea6","vmScaleSetName":"88t8-2025-11-12-ubuntu2204","vmSize":"Standard_D2ads_v6","zone":""},"network":{"interface":[{"ipv4":{"ipAddress":[{"privateIpAddress":"10.224.0.7","publicIpAddress":""}],"subnet":[{"address":"10.224.0.0","prefix":"16"}]},"ipv6":{"ipAddress":[]},"macAddress":"000D3AFE890C"}]}}'
++ jq -r '.compute.tagsList[] | select(.name == "SkipBinaryCleanup") | .value'
+ should_skip=
+ echo ''
++ exitStatus=0
++ '[' 0 -eq 0 ']'
++ break
++ '[' false = true ']'
++ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
++ return 0
+ SKIP_BINARY_CLEANUP=
++ getInstallModeAndCleanupContainerImages '' true
++ tail -1
++ local SKIP_BINARY_CLEANUP=
++ local IS_VHD=true
++ '[' '!' -f /opt/azure/vhd-install.complete ']'
++ FULL_INSTALL_REQUIRED=true
++ '[' '' = true ']'
++ '[' -f /opt/azure/vhd-install.complete ']'
++ echo 'detected golden image pre-install'
++ logs_to_events AKS.CSE.cleanUpContainerImages cleanUpContainerImages
++ local task=AKS.CSE.cleanUpContainerImages
++ shift
+++ date +%s%3N
++ local eventsFileName=1762984519216
+++ date '+%F %T.%3N'
++ local 'startTime=2025-11-12 21:55:19.218'
++ cleanUpContainerImages
++ export KUBERNETES_VERSION
++ export CLI_TOOL
++ export -f retrycmd_if_failure
++ export -f removeContainerImage
++ export -f cleanUpImages
++ export -f cleanUpKubeProxyImages
++ ret=0
++ bash -c cleanUpKubeProxyImages
+++ date '+%F %T.%3N'
++ local 'endTime=2025-11-12 21:55:19.220'
+++ jq -n --arg Timestamp '2025-11-12 21:55:19.218' --arg OperationId '2025-11-12 21:55:19.220' --arg Version 1.23 --arg TaskName AKS.CSE.cleanUpContainerImages --arg EventLevel Informational --arg Message 'Completed: cleanUpContainerImages' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
environment: _retrycmd_internal: command not found
++ json_string='{
  "Timestamp": "2025-11-12 21:55:19.218",
  "OperationId": "2025-11-12 21:55:19.220",
  "Version": "1.23",
  "TaskName": "AKS.CSE.cleanUpContainerImages",
  "EventLevel": "Informational",
  "Message": "Completed: cleanUpContainerImages",
  "EventPid": "0",
  "EventTid": "0"
}'
++ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
++ echo '{' '"Timestamp":' '"2025-11-12' '21:55:19.218",' '"OperationId":' '"2025-11-12' '21:55:19.220",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.cleanUpContainerImages",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'cleanUpContainerImages",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
++ '[' 0 -ne 0 ']'
++ FULL_INSTALL_REQUIRED=false
++ echo false
+ FULL_INSTALL_REQUIRED=false
+ '[' 0 -ne 0 ']'
+ '[' UBUNTU = UBUNTU ']'
+ '[' false = true ']'
+ echo 'Golden image; skipping dependencies installation'
Golden image; skipping dependencies installation
+ isAzureLinuxOSGuard UBUNTU ''
+ local os=UBUNTU
+ local os_variant=
+ '[' UBUNTU = AZURELINUX ']'
+ return 1
+ logs_to_events AKS.CSE.installContainerRuntime installContainerRuntime
+ local task=AKS.CSE.installContainerRuntime
+ shift
++ date +%s%3N
+ local eventsFileName=1762984519243
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:19.244'
+ installContainerRuntime
+ echo 'in installContainerRuntime - KUBERNETES_VERSION = 1.32.9'
in installContainerRuntime - KUBERNETES_VERSION = 1.32.9
+ '[' -f /opt/azure/components.json ']'
+ jq '.Packages[] | select(.name == "containerd")'
+ echo 'Package "containerd" exists in /opt/azure/components.json.'
Package "containerd" exists in /opt/azure/components.json.
+ installContainerdWithComponentsJson
+ os=UBUNTU
+ '[' -z 22.04 ']'
+ os_version=22.04
++ jq .Packages /opt/azure/components.json
++ jq '.[] | select(.name == "containerd")'
+ containerdPackage='{
  "name": "containerd",
  "downloadLocation": "/opt/containerd/downloads",
  "windowsDownloadLocation": "c:\\akse-cache\\containerd\\",
  "downloadURIs": {
    "ubuntu": {
      "r2404": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=test, os=ubuntu, release=24.04",
            "latestVersion": "2.1.4-ubuntu24.04u1"
          }
        ]
      },
      "r2204": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=22.04",
            "latestVersion": "1.7.28-ubuntu22.04u1"
          }
        ]
      },
      "r2004": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=20.04",
            "latestVersion": "1.7.28-ubuntu20.04u1"
          }
        ]
      }
    },
    "mariner": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/cbl-mariner/2.0/prod/base/x86_64/repodata, name=moby-containerd, os=mariner, release=2.0",
            "latestVersion": "1.6.26-12.cm2"
          }
        ]
      }
    },
    "marinerkata": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "azurelinux": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/azurelinux/3.0/prod/base/x86_64/repodata, name=containerd2, os=azurelinux, release=3.0",
            "latestVersion": "2.0.0-14.azl3"
          }
        ]
      }
    },
    "azurelinuxkata": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "windows": {
      "ws2019": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2022": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2025": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "default": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.7.20"
          }
        ]
      }
    }
  }
}'
+ PACKAGE_VERSIONS=()
+ isMariner UBUNTU
+ local os=UBUNTU
+ '[' UBUNTU = MARINER ']'
+ '[' UBUNTU = MARINERKATA ']'
+ return 1
+ isAzureLinux UBUNTU
+ local os=UBUNTU
+ '[' UBUNTU = AZURELINUX ']'
+ '[' UBUNTU = AZURELINUXKATA ']'
+ return 1
+ updatePackageVersions '{
  "name": "containerd",
  "downloadLocation": "/opt/containerd/downloads",
  "windowsDownloadLocation": "c:\\akse-cache\\containerd\\",
  "downloadURIs": {
    "ubuntu": {
      "r2404": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=test, os=ubuntu, release=24.04",
            "latestVersion": "2.1.4-ubuntu24.04u1"
          }
        ]
      },
      "r2204": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=22.04",
            "latestVersion": "1.7.28-ubuntu22.04u1"
          }
        ]
      },
      "r2004": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=20.04",
            "latestVersion": "1.7.28-ubuntu20.04u1"
          }
        ]
      }
    },
    "mariner": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/cbl-mariner/2.0/prod/base/x86_64/repodata, name=moby-containerd, os=mariner, release=2.0",
            "latestVersion": "1.6.26-12.cm2"
          }
        ]
      }
    },
    "marinerkata": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "azurelinux": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/azurelinux/3.0/prod/base/x86_64/repodata, name=containerd2, os=azurelinux, release=3.0",
            "latestVersion": "2.0.0-14.azl3"
          }
        ]
      }
    },
    "azurelinuxkata": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "windows": {
      "ws2019": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2022": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2025": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "default": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.7.20"
          }
        ]
      }
    }
  }
}' UBUNTU 22.04
+ local 'package={
  "name": "containerd",
  "downloadLocation": "/opt/containerd/downloads",
  "windowsDownloadLocation": "c:\\akse-cache\\containerd\\",
  "downloadURIs": {
    "ubuntu": {
      "r2404": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=test, os=ubuntu, release=24.04",
            "latestVersion": "2.1.4-ubuntu24.04u1"
          }
        ]
      },
      "r2204": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=22.04",
            "latestVersion": "1.7.28-ubuntu22.04u1"
          }
        ]
      },
      "r2004": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=20.04",
            "latestVersion": "1.7.28-ubuntu20.04u1"
          }
        ]
      }
    },
    "mariner": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/cbl-mariner/2.0/prod/base/x86_64/repodata, name=moby-containerd, os=mariner, release=2.0",
            "latestVersion": "1.6.26-12.cm2"
          }
        ]
      }
    },
    "marinerkata": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "azurelinux": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/azurelinux/3.0/prod/base/x86_64/repodata, name=containerd2, os=azurelinux, release=3.0",
            "latestVersion": "2.0.0-14.azl3"
          }
        ]
      }
    },
    "azurelinuxkata": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "windows": {
      "ws2019": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2022": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2025": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "default": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.7.20"
          }
        ]
      }
    }
  }
}'
+ local os=UBUNTU
+ local osVersion=22.04
+ RELEASE=current
+ updateRelease '{
  "name": "containerd",
  "downloadLocation": "/opt/containerd/downloads",
  "windowsDownloadLocation": "c:\\akse-cache\\containerd\\",
  "downloadURIs": {
    "ubuntu": {
      "r2404": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=test, os=ubuntu, release=24.04",
            "latestVersion": "2.1.4-ubuntu24.04u1"
          }
        ]
      },
      "r2204": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=22.04",
            "latestVersion": "1.7.28-ubuntu22.04u1"
          }
        ]
      },
      "r2004": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=20.04",
            "latestVersion": "1.7.28-ubuntu20.04u1"
          }
        ]
      }
    },
    "mariner": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/cbl-mariner/2.0/prod/base/x86_64/repodata, name=moby-containerd, os=mariner, release=2.0",
            "latestVersion": "1.6.26-12.cm2"
          }
        ]
      }
    },
    "marinerkata": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "azurelinux": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/azurelinux/3.0/prod/base/x86_64/repodata, name=containerd2, os=azurelinux, release=3.0",
            "latestVersion": "2.0.0-14.azl3"
          }
        ]
      }
    },
    "azurelinuxkata": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "windows": {
      "ws2019": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2022": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2025": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "default": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.7.20"
          }
        ]
      }
    }
  }
}' UBUNTU 22.04
+ local 'package={
  "name": "containerd",
  "downloadLocation": "/opt/containerd/downloads",
  "windowsDownloadLocation": "c:\\akse-cache\\containerd\\",
  "downloadURIs": {
    "ubuntu": {
      "r2404": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=test, os=ubuntu, release=24.04",
            "latestVersion": "2.1.4-ubuntu24.04u1"
          }
        ]
      },
      "r2204": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=22.04",
            "latestVersion": "1.7.28-ubuntu22.04u1"
          }
        ]
      },
      "r2004": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=20.04",
            "latestVersion": "1.7.28-ubuntu20.04u1"
          }
        ]
      }
    },
    "mariner": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/cbl-mariner/2.0/prod/base/x86_64/repodata, name=moby-containerd, os=mariner, release=2.0",
            "latestVersion": "1.6.26-12.cm2"
          }
        ]
      }
    },
    "marinerkata": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "azurelinux": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/azurelinux/3.0/prod/base/x86_64/repodata, name=containerd2, os=azurelinux, release=3.0",
            "latestVersion": "2.0.0-14.azl3"
          }
        ]
      }
    },
    "azurelinuxkata": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "windows": {
      "ws2019": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2022": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2025": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "default": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.7.20"
          }
        ]
      }
    }
  }
}'
+ local os=UBUNTU
+ local osVersion=22.04
+ RELEASE=current
++ echo UBUNTU
++ tr '[:upper:]' '[:lower:]'
+ local osLowerCase=ubuntu
+ isMarinerOrAzureLinux UBUNTU
+ local os=UBUNTU
+ '[' UBUNTU = MARINER ']'
+ '[' UBUNTU = MARINERKATA ']'
+ '[' UBUNTU = AZURELINUX ']'
+ '[' UBUNTU = AZURELINUXKATA ']'
+ return 1
++ echo 22.04
++ sed 's/\.//g'
+ local osVersionWithoutDot=2204
++ echo '{
  "name": "containerd",
  "downloadLocation": "/opt/containerd/downloads",
  "windowsDownloadLocation": "c:\\akse-cache\\containerd\\",
  "downloadURIs": {
    "ubuntu": {
      "r2404": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=test, os=ubuntu, release=24.04",
            "latestVersion": "2.1.4-ubuntu24.04u1"
          }
        ]
      },
      "r2204": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=22.04",
            "latestVersion": "1.7.28-ubuntu22.04u1"
          }
        ]
      },
      "r2004": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=20.04",
            "latestVersion": "1.7.28-ubuntu20.04u1"
          }
        ]
      }
    },
    "mariner": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/cbl-mariner/2.0/prod/base/x86_64/repodata, name=moby-containerd, os=mariner, release=2.0",
            "latestVersion": "1.6.26-12.cm2"
          }
        ]
      }
    },
    "marinerkata": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "azurelinux": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/azurelinux/3.0/prod/base/x86_64/repodata, name=containerd2, os=azurelinux, release=3.0",
            "latestVersion": "2.0.0-14.azl3"
          }
        ]
      }
    },
    "azurelinuxkata": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "windows": {
      "ws2019": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2022": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2025": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "default": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.7.20"
          }
        ]
      }
    }
  }
}'
++ jq -r .downloadURIs.ubuntu.r2204
+ '[' '{
  "versionsV2": [
    {
      "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=22.04",
      "latestVersion": "1.7.28-ubuntu22.04u1"
    }
  ]
}' '!=' null ']'
+ RELEASE='"r2204"'
++ echo UBUNTU
++ tr '[:upper:]' '[:lower:]'
+ local osLowerCase=ubuntu
+ PACKAGE_VERSIONS=()
++ echo '{
  "name": "containerd",
  "downloadLocation": "/opt/containerd/downloads",
  "windowsDownloadLocation": "c:\\akse-cache\\containerd\\",
  "downloadURIs": {
    "ubuntu": {
      "r2404": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=test, os=ubuntu, release=24.04",
            "latestVersion": "2.1.4-ubuntu24.04u1"
          }
        ]
      },
      "r2204": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=22.04",
            "latestVersion": "1.7.28-ubuntu22.04u1"
          }
        ]
      },
      "r2004": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=20.04",
            "latestVersion": "1.7.28-ubuntu20.04u1"
          }
        ]
      }
    },
    "mariner": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/cbl-mariner/2.0/prod/base/x86_64/repodata, name=moby-containerd, os=mariner, release=2.0",
            "latestVersion": "1.6.26-12.cm2"
          }
        ]
      }
    },
    "marinerkata": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "azurelinux": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/azurelinux/3.0/prod/base/x86_64/repodata, name=containerd2, os=azurelinux, release=3.0",
            "latestVersion": "2.0.0-14.azl3"
          }
        ]
      }
    },
    "azurelinuxkata": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "windows": {
      "ws2019": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2022": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2025": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "default": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.7.20"
          }
        ]
      }
    }
  }
}'
++ jq -r .downloadURIs.ubuntu
+ '[' '{
  "r2404": {
    "versionsV2": [
      {
        "renovateTag": "name=moby-containerd, repository=test, os=ubuntu, release=24.04",
        "latestVersion": "2.1.4-ubuntu24.04u1"
      }
    ]
  },
  "r2204": {
    "versionsV2": [
      {
        "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=22.04",
        "latestVersion": "1.7.28-ubuntu22.04u1"
      }
    ]
  },
  "r2004": {
    "versionsV2": [
      {
        "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=20.04",
        "latestVersion": "1.7.28-ubuntu20.04u1"
      }
    ]
  }
}' = null ']'
++ echo '{
  "name": "containerd",
  "downloadLocation": "/opt/containerd/downloads",
  "windowsDownloadLocation": "c:\\akse-cache\\containerd\\",
  "downloadURIs": {
    "ubuntu": {
      "r2404": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=test, os=ubuntu, release=24.04",
            "latestVersion": "2.1.4-ubuntu24.04u1"
          }
        ]
      },
      "r2204": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=22.04",
            "latestVersion": "1.7.28-ubuntu22.04u1"
          }
        ]
      },
      "r2004": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=20.04",
            "latestVersion": "1.7.28-ubuntu20.04u1"
          }
        ]
      }
    },
    "mariner": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/cbl-mariner/2.0/prod/base/x86_64/repodata, name=moby-containerd, os=mariner, release=2.0",
            "latestVersion": "1.6.26-12.cm2"
          }
        ]
      }
    },
    "marinerkata": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "azurelinux": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/azurelinux/3.0/prod/base/x86_64/repodata, name=containerd2, os=azurelinux, release=3.0",
            "latestVersion": "2.0.0-14.azl3"
          }
        ]
      }
    },
    "azurelinuxkata": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "windows": {
      "ws2019": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2022": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2025": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "default": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.7.20"
          }
        ]
      }
    }
  }
}'
++ jq -r '.downloadURIs.ubuntu."r2204".versionsV2'
+ '[' '[
  {
    "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=22.04",
    "latestVersion": "1.7.28-ubuntu22.04u1"
  }
]' '!=' null ']'
++ echo '{
  "name": "containerd",
  "downloadLocation": "/opt/containerd/downloads",
  "windowsDownloadLocation": "c:\\akse-cache\\containerd\\",
  "downloadURIs": {
    "ubuntu": {
      "r2404": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=test, os=ubuntu, release=24.04",
            "latestVersion": "2.1.4-ubuntu24.04u1"
          }
        ]
      },
      "r2204": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=22.04",
            "latestVersion": "1.7.28-ubuntu22.04u1"
          }
        ]
      },
      "r2004": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=20.04",
            "latestVersion": "1.7.28-ubuntu20.04u1"
          }
        ]
      }
    },
    "mariner": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/cbl-mariner/2.0/prod/base/x86_64/repodata, name=moby-containerd, os=mariner, release=2.0",
            "latestVersion": "1.6.26-12.cm2"
          }
        ]
      }
    },
    "marinerkata": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "azurelinux": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/azurelinux/3.0/prod/base/x86_64/repodata, name=containerd2, os=azurelinux, release=3.0",
            "latestVersion": "2.0.0-14.azl3"
          }
        ]
      }
    },
    "azurelinuxkata": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "windows": {
      "ws2019": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2022": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2025": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "default": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.7.20"
          }
        ]
      }
    }
  }
}'
++ jq -r '.downloadURIs.ubuntu."r2204".versionsV2[] | select(.latestVersion != null) | .latestVersion'
+ latestVersions=('1.7.28-ubuntu22.04u1')
+ local latestVersions
++ echo '{
  "name": "containerd",
  "downloadLocation": "/opt/containerd/downloads",
  "windowsDownloadLocation": "c:\\akse-cache\\containerd\\",
  "downloadURIs": {
    "ubuntu": {
      "r2404": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=test, os=ubuntu, release=24.04",
            "latestVersion": "2.1.4-ubuntu24.04u1"
          }
        ]
      },
      "r2204": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=22.04",
            "latestVersion": "1.7.28-ubuntu22.04u1"
          }
        ]
      },
      "r2004": {
        "versionsV2": [
          {
            "renovateTag": "name=moby-containerd, repository=production, os=ubuntu, release=20.04",
            "latestVersion": "1.7.28-ubuntu20.04u1"
          }
        ]
      }
    },
    "mariner": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/cbl-mariner/2.0/prod/base/x86_64/repodata, name=moby-containerd, os=mariner, release=2.0",
            "latestVersion": "1.6.26-12.cm2"
          }
        ]
      }
    },
    "marinerkata": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "azurelinux": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "RPM_registry=https://packages.microsoft.com/azurelinux/3.0/prod/base/x86_64/repodata, name=containerd2, os=azurelinux, release=3.0",
            "latestVersion": "2.0.0-14.azl3"
          }
        ]
      }
    },
    "azurelinuxkata": {
      "v3.0": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "<SKIP>"
          }
        ]
      }
    },
    "windows": {
      "ws2019": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2022": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.6.35-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          },
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "ws2025": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v2.0.4-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      },
      "default": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "v1.7.20-azure.1",
            "previousLatestVersion": "v1.7.17-azure.1"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/containerd/windows/${version}/binaries/containerd-${version}-windows-amd64.tar.gz"
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.7.20"
          }
        ]
      }
    }
  }
}'
++ jq -r '.downloadURIs.ubuntu."r2204".versionsV2[] | select(.previousLatestVersion != null) | .previousLatestVersion'
+ previousLatestVersions=()
+ local previousLatestVersions
+ for version in "${latestVersions[@]}"
+ PACKAGE_VERSIONS+=("${version}")
+ return 0
+ [[ 1 -gt 1 ]]
+ [[ 1 -eq 0 ]]
+ [[ 1.7.28-ubuntu22.04u1 == \<\S\K\I\P\> ]]
+ IFS='
'
+ sortedPackageVersions=($(sort -V <<<"${PACKAGE_VERSIONS[*]}"))
++ sort -V
+ unset IFS
+ array_size=1
+ '[' 0 -lt 0 ']'
+ last_index=0
+ packageVersion=1.7.28-ubuntu22.04u1
++ echo 1.7.28-ubuntu22.04u1
++ cut -d- -f1
+ containerdMajorMinorPatchVersion=1.7.28
++ echo 1.7.28-ubuntu22.04u1
++ cut -d- -s -f2
+ containerdHotFixVersion=ubuntu22.04u1
+ '[' -z 1.7.28 ']'
+ '[' 1.7.28 = null ']'
+ '[' ubuntu22.04u1 = null ']'
+ logs_to_events AKS.CSE.installContainerRuntime.installStandaloneContainerd 'installStandaloneContainerd 1.7.28 ubuntu22.04u1'
+ local task=AKS.CSE.installContainerRuntime.installStandaloneContainerd
+ shift
++ date +%s%3N
+ local eventsFileName=1762984519404
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:19.406'
+ installStandaloneContainerd 1.7.28 ubuntu22.04u1
++ lsb_release -r -s
+ UBUNTU_RELEASE=22.04
++ lsb_release -c -s
+ UBUNTU_CODENAME=jammy
+ CONTAINERD_VERSION=1.7.28
+ CONTAINERD_PATCH_VERSION=ubuntu22.04u1
+ CONTAINERD_PACKAGE_URL=
+ '[' '!' -z '' ']'
+ '[' -z 1.7.28 ']'
+ echo 'Using specified Containerd Version: 1.7.28-ubuntu22.04u1'
Using specified Containerd Version: 1.7.28-ubuntu22.04u1
+ installContainerdWithAptGet 1.7.28 ubuntu22.04u1
+ local containerdMajorMinorPatchVersion=1.7.28
+ local containerdHotFixVersion=ubuntu22.04u1
+ CONTAINERD_DOWNLOADS_DIR=/opt/containerd/downloads
+ currentVersion=
+ command -v containerd
++ cut -d + -f 1
++ sed 's|v||'
++ cut -d ' ' -f 3
++ containerd -version
+ currentVersion=1.7.28-1
+ '[' -z 1.7.28-1 ']'
++ echo 1.7.28-1
++ paste -sd.
++ head -n 2
++ tr . '\n'
+ currentMajorMinor=1.7
++ echo 1.7.28
++ paste -sd.
++ tr . '\n'
++ head -n 2
+ desiredMajorMinor=1.7
+ semverCompare 1.7.28-1 1.7.28
++ echo 1.7.28-1
++ cut -d '~' -f 1
++ cut -d + -f 1
+ VERSION_A=1.7.28-1
++ echo 1.7.28
++ cut -d '~' -f 1
++ cut -d + -f 1
+ VERSION_B=1.7.28
+ '[' 1.7.28-1 = 1.7.28 ']'
++ echo 1.7.28-1 1.7.28
++ tr ' ' '\n'
++ sort -V
+ sorted='1.7.28
1.7.28-1'
++ IFS=
++ echo '1.7.28
1.7.28-1'
++ cut '-d
' -f2
+ highestVersion=1.7.28-1
+ '[' 1.7.28-1 = 1.7.28-1 ']'
+ return 0
+ hasGreaterVersion=0
+ '[' 0 = 0 ']'
+ '[' 1.7 = 1.7 ']'
+ echo 'currently installed containerd version 1.7.28-1 matches major.minor with higher patch 1.7.28. skipping installStandaloneContainerd.'
currently installed containerd version 1.7.28-1 matches major.minor with higher patch 1.7.28. skipping installStandaloneContainerd.
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:19.521'
++ jq -n --arg Timestamp '2025-11-12 21:55:19.406' --arg OperationId '2025-11-12 21:55:19.521' --arg Version 1.23 --arg TaskName AKS.CSE.installContainerRuntime.installStandaloneContainerd --arg EventLevel Informational --arg Message 'Completed: installStandaloneContainerd 1.7.28 ubuntu22.04u1' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:19.406",
  "OperationId": "2025-11-12 21:55:19.521",
  "Version": "1.23",
  "TaskName": "AKS.CSE.installContainerRuntime.installStandaloneContainerd",
  "EventLevel": "Informational",
  "Message": "Completed: installStandaloneContainerd 1.7.28 ubuntu22.04u1",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:19.406",' '"OperationId":' '"2025-11-12' '21:55:19.521",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.installContainerRuntime.installStandaloneContainerd",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' installStandaloneContainerd 1.7.28 'ubuntu22.04u1",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ echo 'in installContainerRuntime - CONTAINERD_VERSION = 1.7.28-ubuntu22.04u1'
in installContainerRuntime - CONTAINERD_VERSION = 1.7.28-ubuntu22.04u1
+ return
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:19.539'
++ jq -n --arg Timestamp '2025-11-12 21:55:19.244' --arg OperationId '2025-11-12 21:55:19.539' --arg Version 1.23 --arg TaskName AKS.CSE.installContainerRuntime --arg EventLevel Informational --arg Message 'Completed: installContainerRuntime' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:19.244",
  "OperationId": "2025-11-12 21:55:19.539",
  "Version": "1.23",
  "TaskName": "AKS.CSE.installContainerRuntime",
  "EventLevel": "Informational",
  "Message": "Completed: installContainerRuntime",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:19.244",' '"OperationId":' '"2025-11-12' '21:55:19.539",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.installContainerRuntime",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'installContainerRuntime",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ '[' false = true ']'
+ setupCNIDirs
+ mkdir -p /opt/cni/bin
+ chown -R root:root /opt/cni/bin
+ chmod -R 755 /opt/cni/bin
+ mkdir -p /etc/cni/net.d
+ chown -R root:root /etc/cni/net.d
+ chmod 755 /etc/cni/net.d
+ isAzureLinuxOSGuard UBUNTU ''
+ local os=UBUNTU
+ local os_variant=
+ '[' UBUNTU = AZURELINUX ']'
+ return 1
+ logs_to_events AKS.CSE.installNetworkPlugin installNetworkPlugin
+ local task=AKS.CSE.installNetworkPlugin
+ shift
++ date +%s%3N
+ local eventsFileName=1762984519575
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:19.577'
+ installNetworkPlugin
+ '[' kubenet = azure ']'
+ installCNI
+ '[' '!' -f /opt/azure/components.json ']'
+ jq '.Packages[] | select(.name == "cni-plugins")'
++ jq '.[] | select(.name == "cni-plugins")'
++ jq .Packages /opt/azure/components.json
+ cniPackage='{
  "name": "cni-plugins",
  "downloadLocation": "/opt/cni/downloads",
  "downloadURIs": {
    "windows": {
      "default": {
        "versionsV2": []
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.6.2"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/cni-plugins/v${version}/binaries/cni-plugins-linux-${CPU_ARCH}-v${version}.tgz"
      }
    }
  }
}'
+ os=UBUNTU
+ '[' -z 22.04 ']'
+ os_version=22.04
+ isMarinerOrAzureLinux UBUNTU
+ local os=UBUNTU
+ '[' UBUNTU = MARINER ']'
+ '[' UBUNTU = MARINERKATA ']'
+ '[' UBUNTU = AZURELINUX ']'
+ '[' UBUNTU = AZURELINUXKATA ']'
+ return 1
+ PACKAGE_VERSIONS=()
+ updatePackageVersions '{
  "name": "cni-plugins",
  "downloadLocation": "/opt/cni/downloads",
  "downloadURIs": {
    "windows": {
      "default": {
        "versionsV2": []
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.6.2"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/cni-plugins/v${version}/binaries/cni-plugins-linux-${CPU_ARCH}-v${version}.tgz"
      }
    }
  }
}' UBUNTU 22.04
+ local 'package={
  "name": "cni-plugins",
  "downloadLocation": "/opt/cni/downloads",
  "downloadURIs": {
    "windows": {
      "default": {
        "versionsV2": []
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.6.2"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/cni-plugins/v${version}/binaries/cni-plugins-linux-${CPU_ARCH}-v${version}.tgz"
      }
    }
  }
}'
+ local os=UBUNTU
+ local osVersion=22.04
+ RELEASE=current
+ updateRelease '{
  "name": "cni-plugins",
  "downloadLocation": "/opt/cni/downloads",
  "downloadURIs": {
    "windows": {
      "default": {
        "versionsV2": []
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.6.2"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/cni-plugins/v${version}/binaries/cni-plugins-linux-${CPU_ARCH}-v${version}.tgz"
      }
    }
  }
}' UBUNTU 22.04
+ local 'package={
  "name": "cni-plugins",
  "downloadLocation": "/opt/cni/downloads",
  "downloadURIs": {
    "windows": {
      "default": {
        "versionsV2": []
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.6.2"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/cni-plugins/v${version}/binaries/cni-plugins-linux-${CPU_ARCH}-v${version}.tgz"
      }
    }
  }
}'
+ local os=UBUNTU
+ local osVersion=22.04
+ RELEASE=current
++ echo UBUNTU
++ tr '[:upper:]' '[:lower:]'
+ local osLowerCase=ubuntu
+ isMarinerOrAzureLinux UBUNTU
+ local os=UBUNTU
+ '[' UBUNTU = MARINER ']'
+ '[' UBUNTU = MARINERKATA ']'
+ '[' UBUNTU = AZURELINUX ']'
+ '[' UBUNTU = AZURELINUXKATA ']'
+ return 1
++ echo 22.04
++ sed 's/\.//g'
+ local osVersionWithoutDot=2204
++ jq -r .downloadURIs.ubuntu.r2204
++ echo '{
  "name": "cni-plugins",
  "downloadLocation": "/opt/cni/downloads",
  "downloadURIs": {
    "windows": {
      "default": {
        "versionsV2": []
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.6.2"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/cni-plugins/v${version}/binaries/cni-plugins-linux-${CPU_ARCH}-v${version}.tgz"
      }
    }
  }
}'
+ '[' null '!=' null ']'
++ echo UBUNTU
++ tr '[:upper:]' '[:lower:]'
+ local osLowerCase=ubuntu
+ PACKAGE_VERSIONS=()
++ jq -r .downloadURIs.ubuntu
++ echo '{
  "name": "cni-plugins",
  "downloadLocation": "/opt/cni/downloads",
  "downloadURIs": {
    "windows": {
      "default": {
        "versionsV2": []
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.6.2"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/cni-plugins/v${version}/binaries/cni-plugins-linux-${CPU_ARCH}-v${version}.tgz"
      }
    }
  }
}'
+ '[' null = null ']'
+ osLowerCase=default
++ echo '{
  "name": "cni-plugins",
  "downloadLocation": "/opt/cni/downloads",
  "downloadURIs": {
    "windows": {
      "default": {
        "versionsV2": []
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.6.2"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/cni-plugins/v${version}/binaries/cni-plugins-linux-${CPU_ARCH}-v${version}.tgz"
      }
    }
  }
}'
++ jq -r .downloadURIs.default.current.versionsV2
+ '[' '[
  {
    "renovateTag": "<DO_NOT_UPDATE>",
    "latestVersion": "1.6.2"
  }
]' '!=' null ']'
++ echo '{
  "name": "cni-plugins",
  "downloadLocation": "/opt/cni/downloads",
  "downloadURIs": {
    "windows": {
      "default": {
        "versionsV2": []
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.6.2"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/cni-plugins/v${version}/binaries/cni-plugins-linux-${CPU_ARCH}-v${version}.tgz"
      }
    }
  }
}'
++ jq -r '.downloadURIs.default.current.versionsV2[] | select(.latestVersion != null) | .latestVersion'
+ latestVersions=('1.6.2')
+ local latestVersions
++ echo '{
  "name": "cni-plugins",
  "downloadLocation": "/opt/cni/downloads",
  "downloadURIs": {
    "windows": {
      "default": {
        "versionsV2": []
      }
    },
    "default": {
      "current": {
        "versionsV2": [
          {
            "renovateTag": "<DO_NOT_UPDATE>",
            "latestVersion": "1.6.2"
          }
        ],
        "downloadURL": "https://packages.aks.azure.com/cni-plugins/v${version}/binaries/cni-plugins-linux-${CPU_ARCH}-v${version}.tgz"
      }
    }
  }
}'
++ jq -r '.downloadURIs.default.current.versionsV2[] | select(.previousLatestVersion != null) | .previousLatestVersion'
+ previousLatestVersions=()
+ local previousLatestVersions
+ for version in "${latestVersions[@]}"
+ PACKAGE_VERSIONS+=("${version}")
+ return 0
+ [[ 1 -gt 1 ]]
+ packageVersion=1.6.2
++ isARM64
+++ getCPUArch
++++ uname -m
+++ arch=x86_64
+++ [[ x86_64 == \a\a\r\c\h\6\4 ]]
+++ [[ x86_64 == \a\r\m\6\4 ]]
+++ echo amd64
++ '[' amd64 = arm64 ']'
++ echo 0
+ '[' 0 -eq 1 ']'
+ CNI_DIR_TMP=cni-plugins-linux-amd64-v1.6.2
+ '[' -d /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2 ']'
+ mv /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/LICENSE /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/README.md /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/bandwidth /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/bridge /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/dhcp /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/dummy /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/firewall /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/host-device /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/host-local /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/ipvlan /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/loopback /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/macvlan /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/portmap /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/ptp /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/sbr /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/static /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/tap /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/tuning /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/vlan /opt/cni/downloads/cni-plugins-linux-amd64-v1.6.2/vrf /opt/cni/bin
+ chown -R root:root /opt/cni/bin
+ ret=0
+ rm -rf /opt/cni/downloads
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:19.738'
++ jq -n --arg Timestamp '2025-11-12 21:55:19.577' --arg OperationId '2025-11-12 21:55:19.738' --arg Version 1.23 --arg TaskName AKS.CSE.installNetworkPlugin --arg EventLevel Informational --arg Message 'Completed: installNetworkPlugin' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:19.577",
  "OperationId": "2025-11-12 21:55:19.738",
  "Version": "1.23",
  "TaskName": "AKS.CSE.installNetworkPlugin",
  "EventLevel": "Informational",
  "Message": "Completed: installNetworkPlugin",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:19.577",' '"OperationId":' '"2025-11-12' '21:55:19.738",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.installNetworkPlugin",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'installNetworkPlugin",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ export -f should_enforce_kube_pmc_install
++ retrycmd_silent 10 1 10 bash -cx should_enforce_kube_pmc_install
++ _retrycmd_internal 10 1 10 false bash -cx should_enforce_kube_pmc_install
++ local retries=10
++ shift
++ local waitSleep=1
++ shift
++ local timeoutVal=10
++ shift
++ local shouldLog=false
++ shift
++ cmdToRun=('bash' '-cx' 'should_enforce_kube_pmc_install')
++ local cmdToRun
++ local exitStatus=0
+++ seq 1 10
++ for i in $(seq 1 "$retries")
++ timeout 10 bash -cx should_enforce_kube_pmc_install
+ should_enforce_kube_pmc_install
+ set -x
++ curl -fsSL -H 'Metadata: true' --noproxy '*' 'http://169.254.169.254/metadata/instance?api-version=2021-02-01'
+ body='{"compute":{"azEnvironment":"AzurePublicCloud","customData":"","evictionPolicy":"","isHostCompatibilityLayerVm":"false","licenseType":"","location":"westus2","name":"88t8-2025-11-12-ubuntu2204_0","offer":"","osProfile":{"adminUsername":"azureuser","computerName":"88t8-2025-11-12-ubuntu2204000000","disablePasswordAuthentication":"true"},"osType":"Linux","placementGroupId":"c61ccfee-96ef-40f5-a960-3f4b85676bcb","plan":{"name":"","product":"","publisher":""},"platformFaultDomain":"0","platformUpdateDomain":"0","priority":"","provider":"Microsoft.Compute","publicKeys":[{"keyData":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC8i1dJi2pq3jYOaEYIJnM4/Lggs7Sa26Q3aAWy8GRB3qJUzINbkOJgOMWGnN2mnRHJTKqBKttXs8A8NCoUE1FwNve70gfGnoo1tLjF/hkaITsAfDm0+Clk6p4a26SkbjqdkHexNrcbn4JqY6EJqLvYd7PtjSREB+Ky+IJghdHem5RJxSs4/MrbvcNe2hPJgF9vcTJfjiLbGsR1cwWg0pBdlIY73BJnWdNlHrpCoxlYgnb8OJuqGv3vjw9RKCBfa/rzh4qZuR4L0SrFX+Pu3OS1aRT/Z5PS1Nwg8rW7NC+E9rsL0+yBt1+7qUrLxU4arq/vyqAxH+DCa+Qvu174BAkYVyA4y2BmLI2Wdw6qgRmtjZTJcH2zXCYRx1L1qp7FngXCDNDE1diDKSdazv9/YQNyIwxzqAKU5bsWM7Lo72mDiae1r8z61tfHFOMAQi/Hkz5RFbwt/4gjQGadxf2x7b7sMGSeqFjXxPvTf2ylVyll0113j3jEL6ho5GvlKPsftvlT7ClrV0cCquZkZ3pZYDX7TE1zlnvkLloh/Iir/Uq6KacPc4Y3kKTK6hRpXVCbzwlapHFHQXGqvZ12EjIfp9WpF1YXLVrStoM3DCpCeqLn11gsTF/6v9Z0ZaYsSrQuBxqFefDNoA7B7djm5wdOHOfXsT/ygXooBW660s4GeKfDTw==\n","path":"/home/azureuser/.ssh/authorized_keys"}],"publisher":"","resourceGroupName":"MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2","resourceId":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/virtualMachineScaleSets/88t8-2025-11-12-ubuntu2204/virtualMachines/0","securityProfile":{"secureBootEnabled":"false","virtualTpmEnabled":"false"},"sku":"","storageProfile":{"dataDisks":[],"imageReference":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/packer/providers/Microsoft.Compute/galleries/akse2esig/images/aks-ubuntu-containerd-22.04-gen2/versions/1.1762806891.5705","offer":"","publisher":"","sku":"","version":""},"osDisk":{"caching":"ReadOnly","createOption":"FromImage","diffDiskSettings":{"option":"Local"},"diskSizeGB":"50","encryptionSettings":{"enabled":"false"},"image":{"uri":""},"managedDisk":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/disks/88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","storageAccountType":"Standard_LRS"},"name":"88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","osType":"Linux","vhd":{"uri":""},"writeAcceleratorEnabled":"false"},"resourceDisk":{"size":"0"}},"subscriptionId":"0660fddc-d191-4bad-b922-e69492903e0a","tags":"KEEP_VMSS:true;buildID:local;owner:e2e","tagsList":[{"name":"KEEP_VMSS","value":"true"},{"name":"buildID","value":"local"},{"name":"owner","value":"e2e"}],"userData":"","version":"1.1762806891.5705","vmId":"8b8bafc0-8aec-4bde-9f61-7069689d3ea6","vmScaleSetName":"88t8-2025-11-12-ubuntu2204","vmSize":"Standard_D2ads_v6","zone":""},"network":{"interface":[{"ipv4":{"ipAddress":[{"privateIpAddress":"10.224.0.7","publicIpAddress":""}],"subnet":[{"address":"10.224.0.0","prefix":"16"}]},"ipv6":{"ipAddress":[]},"macAddress":"000D3AFE890C"}]}}'
+ ret=0
+ '[' 0 -ne 0 ']'
++ echo '{"compute":{"azEnvironment":"AzurePublicCloud","customData":"","evictionPolicy":"","isHostCompatibilityLayerVm":"false","licenseType":"","location":"westus2","name":"88t8-2025-11-12-ubuntu2204_0","offer":"","osProfile":{"adminUsername":"azureuser","computerName":"88t8-2025-11-12-ubuntu2204000000","disablePasswordAuthentication":"true"},"osType":"Linux","placementGroupId":"c61ccfee-96ef-40f5-a960-3f4b85676bcb","plan":{"name":"","product":"","publisher":""},"platformFaultDomain":"0","platformUpdateDomain":"0","priority":"","provider":"Microsoft.Compute","publicKeys":[{"keyData":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC8i1dJi2pq3jYOaEYIJnM4/Lggs7Sa26Q3aAWy8GRB3qJUzINbkOJgOMWGnN2mnRHJTKqBKttXs8A8NCoUE1FwNve70gfGnoo1tLjF/hkaITsAfDm0+Clk6p4a26SkbjqdkHexNrcbn4JqY6EJqLvYd7PtjSREB+Ky+IJghdHem5RJxSs4/MrbvcNe2hPJgF9vcTJfjiLbGsR1cwWg0pBdlIY73BJnWdNlHrpCoxlYgnb8OJuqGv3vjw9RKCBfa/rzh4qZuR4L0SrFX+Pu3OS1aRT/Z5PS1Nwg8rW7NC+E9rsL0+yBt1+7qUrLxU4arq/vyqAxH+DCa+Qvu174BAkYVyA4y2BmLI2Wdw6qgRmtjZTJcH2zXCYRx1L1qp7FngXCDNDE1diDKSdazv9/YQNyIwxzqAKU5bsWM7Lo72mDiae1r8z61tfHFOMAQi/Hkz5RFbwt/4gjQGadxf2x7b7sMGSeqFjXxPvTf2ylVyll0113j3jEL6ho5GvlKPsftvlT7ClrV0cCquZkZ3pZYDX7TE1zlnvkLloh/Iir/Uq6KacPc4Y3kKTK6hRpXVCbzwlapHFHQXGqvZ12EjIfp9WpF1YXLVrStoM3DCpCeqLn11gsTF/6v9Z0ZaYsSrQuBxqFefDNoA7B7djm5wdOHOfXsT/ygXooBW660s4GeKfDTw==\n","path":"/home/azureuser/.ssh/authorized_keys"}],"publisher":"","resourceGroupName":"MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2","resourceId":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/virtualMachineScaleSets/88t8-2025-11-12-ubuntu2204/virtualMachines/0","securityProfile":{"secureBootEnabled":"false","virtualTpmEnabled":"false"},"sku":"","storageProfile":{"dataDisks":[],"imageReference":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/packer/providers/Microsoft.Compute/galleries/akse2esig/images/aks-ubuntu-containerd-22.04-gen2/versions/1.1762806891.5705","offer":"","publisher":"","sku":"","version":""},"osDisk":{"caching":"ReadOnly","createOption":"FromImage","diffDiskSettings":{"option":"Local"},"diskSizeGB":"50","encryptionSettings":{"enabled":"false"},"image":{"uri":""},"managedDisk":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/disks/88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","storageAccountType":"Standard_LRS"},"name":"88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","osType":"Linux","vhd":{"uri":""},"writeAcceleratorEnabled":"false"},"resourceDisk":{"size":"0"}},"subscriptionId":"0660fddc-d191-4bad-b922-e69492903e0a","tags":"KEEP_VMSS:true;buildID:local;owner:e2e","tagsList":[{"name":"KEEP_VMSS","value":"true"},{"name":"buildID","value":"local"},{"name":"owner","value":"e2e"}],"userData":"","version":"1.1762806891.5705","vmId":"8b8bafc0-8aec-4bde-9f61-7069689d3ea6","vmScaleSetName":"88t8-2025-11-12-ubuntu2204","vmSize":"Standard_D2ads_v6","zone":""},"network":{"interface":[{"ipv4":{"ipAddress":[{"privateIpAddress":"10.224.0.7","publicIpAddress":""}],"subnet":[{"address":"10.224.0.0","prefix":"16"}]},"ipv6":{"ipAddress":[]},"macAddress":"000D3AFE890C"}]}}'
++ jq -r '.compute.tagsList[] | select(.name == "ShouldEnforceKubePMCInstall") | .value'
+ should_enforce=
+ echo ''
++ exitStatus=0
++ '[' 0 -eq 0 ']'
++ break
++ '[' false = true ']'
++ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
++ return 0
+ SHOULD_ENFORCE_KUBE_PMC_INSTALL=
+ logs_to_events AKS.CSE.configureKubeletAndKubectl configureKubeletAndKubectl
+ local task=AKS.CSE.configureKubeletAndKubectl
+ shift
++ date +%s%3N
+ local eventsFileName=1762984519787
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:19.789'
+ configureKubeletAndKubectl
+ '[' -n '' ']'
+ '[' -n '' ']'
+ '[' '' '!=' true ']'
+ semverCompare 1.32.9 1.34.0
++ echo 1.32.9
++ cut -d '~' -f 1
++ cut -d + -f 1
+ VERSION_A=1.32.9
++ echo 1.34.0
++ cut -d '~' -f 1
++ cut -d + -f 1
+ VERSION_B=1.34.0
+ '[' 1.32.9 = 1.34.0 ']'
++ echo 1.32.9 1.34.0
++ sort -V
++ tr ' ' '\n'
+ sorted='1.32.9
1.34.0'
++ IFS=
++ echo '1.32.9
1.34.0'
++ cut '-d
' -f2
+ highestVersion=1.34.0
+ '[' 1.32.9 = 1.34.0 ']'
+ return 1
+ logs_to_events AKS.CSE.configureKubeletAndKubectl.installKubeletKubectlFromURL installKubeletKubectlFromURL
+ local task=AKS.CSE.configureKubeletAndKubectl.installKubeletKubectlFromURL
+ shift
++ date +%s%3N
+ local eventsFileName=1762984519801
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:19.803'
+ installKubeletKubectlFromURL
+ CUSTOM_KUBE_BINARY_DOWNLOAD_URL=
+ PRIVATE_KUBE_BINARY_DOWNLOAD_URL=
+ echo 'using private url: , custom url: '
using private url: , custom url: 
+ install_default_if_missing=true
+ '[' '!' -z '' ']'
+ '[' '!' -z '' ']'
+ '[' '!' -f /usr/local/bin/kubectl-1.32.9 ']'
+ '[' '!' -f /usr/local/bin/kubelet-1.32.9 ']'
+ mv /usr/local/bin/kubelet-1.32.9 /usr/local/bin/kubelet
+ mv /usr/local/bin/kubectl-1.32.9 /usr/local/bin/kubectl
+ chmod a+x /usr/local/bin/kubelet /usr/local/bin/kubectl
+ ret=0
+ rm -rf /usr/local/bin/kubelet-1.28.101-akslts /usr/local/bin/kubelet-1.28.102-akslts /usr/local/bin/kubelet-1.29.100-akslts /usr/local/bin/kubelet-1.29.14 /usr/local/bin/kubelet-1.29.15 /usr/local/bin/kubelet-1.30.100-akslts /usr/local/bin/kubelet-1.30.13 /usr/local/bin/kubelet-1.30.14 /usr/local/bin/kubelet-1.31.11 /usr/local/bin/kubelet-1.31.13 /usr/local/bin/kubelet-1.32.7 /usr/local/bin/kubelet-1.33.4 /usr/local/bin/kubelet-1.33.5 /usr/local/bin/kubelet-1.34.0 /usr/local/bin/kubelet-1.34.1 /usr/local/bin/kubectl-1.28.101-akslts /usr/local/bin/kubectl-1.28.102-akslts /usr/local/bin/kubectl-1.29.100-akslts /usr/local/bin/kubectl-1.29.14 /usr/local/bin/kubectl-1.29.15 /usr/local/bin/kubectl-1.30.100-akslts /usr/local/bin/kubectl-1.30.13 /usr/local/bin/kubectl-1.30.14 /usr/local/bin/kubectl-1.31.11 /usr/local/bin/kubectl-1.31.13 /usr/local/bin/kubectl-1.32.7 /usr/local/bin/kubectl-1.33.4 /usr/local/bin/kubectl-1.33.5 /usr/local/bin/kubectl-1.34.0 /usr/local/bin/kubectl-1.34.1 /home/hyperkube-downloads
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:19.809'
++ jq -n --arg Timestamp '2025-11-12 21:55:19.803' --arg OperationId '2025-11-12 21:55:19.809' --arg Version 1.23 --arg TaskName AKS.CSE.configureKubeletAndKubectl.installKubeletKubectlFromURL --arg EventLevel Informational --arg Message 'Completed: installKubeletKubectlFromURL' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:19.803",
  "OperationId": "2025-11-12 21:55:19.809",
  "Version": "1.23",
  "TaskName": "AKS.CSE.configureKubeletAndKubectl.installKubeletKubectlFromURL",
  "EventLevel": "Informational",
  "Message": "Completed: installKubeletKubectlFromURL",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:19.803",' '"OperationId":' '"2025-11-12' '21:55:19.809",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.configureKubeletAndKubectl.installKubeletKubectlFromURL",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'installKubeletKubectlFromURL",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:19.827'
++ jq -n --arg Timestamp '2025-11-12 21:55:19.789' --arg OperationId '2025-11-12 21:55:19.827' --arg Version 1.23 --arg TaskName AKS.CSE.configureKubeletAndKubectl --arg EventLevel Informational --arg Message 'Completed: configureKubeletAndKubectl' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:19.789",
  "OperationId": "2025-11-12 21:55:19.827",
  "Version": "1.23",
  "TaskName": "AKS.CSE.configureKubeletAndKubectl",
  "EventLevel": "Informational",
  "Message": "Completed: configureKubeletAndKubectl",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:19.789",' '"OperationId":' '"2025-11-12' '21:55:19.827",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.configureKubeletAndKubectl",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'configureKubeletAndKubectl",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ createKubeManifestDir
+ KUBEMANIFESTDIR=/etc/kubernetes/manifests
+ mkdir -p /etc/kubernetes/manifests
+ '[' false = true ']'
+ mkdir -p /etc/systemd/system/kubelet.service.d
+ logs_to_events AKS.CSE.configureCNI configureCNI
+ local task=AKS.CSE.configureCNI
+ shift
++ date +%s%3N
+ local eventsFileName=1762984519847
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:19.849'
+ configureCNI
+ retrycmd_if_failure 120 5 25 modprobe br_netfilter
+ _retrycmd_internal 120 5 25 true modprobe br_netfilter
+ local retries=120
+ shift
+ local waitSleep=5
+ shift
+ local timeoutVal=25
+ shift
+ local shouldLog=true
+ shift
+ cmdToRun=('modprobe' 'br_netfilter')
+ local cmdToRun
+ local exitStatus=0
++ seq 1 120
+ for i in $(seq 1 "$retries")
+ timeout 25 modprobe br_netfilter
+ exitStatus=0
+ '[' 0 -eq 0 ']'
+ break
+ '[' true = true ']'
+ '[' 0 -eq 0 ']'
+ echo 'Executed "modprobe br_netfilter" 1 times.'
Executed "modprobe br_netfilter" 1 times.
+ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
+ return 0
+ echo -n br_netfilter
+ configureCNIIPTables
+ '[' kubenet = azure ']'
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:20.069'
++ jq -n --arg Timestamp '2025-11-12 21:55:19.849' --arg OperationId '2025-11-12 21:55:20.069' --arg Version 1.23 --arg TaskName AKS.CSE.configureCNI --arg EventLevel Informational --arg Message 'Completed: configureCNI' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:19.849",
  "OperationId": "2025-11-12 21:55:20.069",
  "Version": "1.23",
  "TaskName": "AKS.CSE.configureCNI",
  "EventLevel": "Informational",
  "Message": "Completed: configureCNI",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:19.849",' '"OperationId":' '"2025-11-12' '21:55:20.069",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.configureCNI",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'configureCNI",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ '[' false = true ']'
+ isMarinerOrAzureLinux UBUNTU
+ local os=UBUNTU
+ '[' UBUNTU = MARINER ']'
+ '[' UBUNTU = MARINERKATA ']'
+ '[' UBUNTU = AZURELINUX ']'
+ '[' UBUNTU = AZURELINUXKATA ']'
+ return 1
+ logs_to_events AKS.CSE.ensureContainerd ensureContainerd
+ local task=AKS.CSE.ensureContainerd
+ shift
++ date +%s%3N
+ local eventsFileName=1762984520085
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:20.086'
+ ensureContainerd
+ '[' false = true ']'
+ mkdir -p /etc/systemd/system/containerd.service.d
+ tee /etc/systemd/system/containerd.service.d/exec_start.conf
+ mkdir -p /etc/containerd
+ '[' false = true ']'
+ echo 'Generating containerd config...'
Generating containerd config...
+ echo dmVyc2lvbiA9IDIKb29tX3Njb3JlID0gLTk5OQpbcGx1Z2lucy4iaW8uY29udGFpbmVyZC5ncnBjLnYxLmNyaSJdCiAgc2FuZGJveF9pbWFnZSA9ICJtY3IubWljcm9zb2Z0LmNvbS9vc3MvdjIva3ViZXJuZXRlcy9wYXVzZTozLjYiCiAgZW5hYmxlX2NkaSA9IHRydWUKICBbcGx1Z2lucy4iaW8uY29udGFpbmVyZC5ncnBjLnYxLmNyaSIuY29udGFpbmVyZF0KICAgIGRlZmF1bHRfcnVudGltZV9uYW1lID0gInJ1bmMiCiAgICBbcGx1Z2lucy4iaW8uY29udGFpbmVyZC5ncnBjLnYxLmNyaSIuY29udGFpbmVyZC5ydW50aW1lcy5ydW5jXQogICAgICBydW50aW1lX3R5cGUgPSAiaW8uY29udGFpbmVyZC5ydW5jLnYyIgogICAgW3BsdWdpbnMuImlvLmNvbnRhaW5lcmQuZ3JwYy52MS5jcmkiLmNvbnRhaW5lcmQucnVudGltZXMucnVuYy5vcHRpb25zXQogICAgICBCaW5hcnlOYW1lID0gIi91c3IvYmluL3J1bmMiCiAgICAgIFN5c3RlbWRDZ3JvdXAgPSB0cnVlCiAgICBbcGx1Z2lucy4iaW8uY29udGFpbmVyZC5ncnBjLnYxLmNyaSIuY29udGFpbmVyZC5ydW50aW1lcy51bnRydXN0ZWRdCiAgICAgIHJ1bnRpbWVfdHlwZSA9ICJpby5jb250YWluZXJkLnJ1bmMudjIiCiAgICBbcGx1Z2lucy4iaW8uY29udGFpbmVyZC5ncnBjLnYxLmNyaSIuY29udGFpbmVyZC5ydW50aW1lcy51bnRydXN0ZWQub3B0aW9uc10KICAgICAgQmluYXJ5TmFtZSA9ICIvdXNyL2Jpbi9ydW5jIgogIFtwbHVnaW5zLiJpby5jb250YWluZXJkLmdycGMudjEuY3JpIi5jbmldCiAgICBiaW5fZGlyID0gIi9vcHQvY25pL2JpbiIKICAgIGNvbmZfZGlyID0gIi9ldGMvY25pL25ldC5kIgogICAgY29uZl90ZW1wbGF0ZSA9ICIvZXRjL2NvbnRhaW5lcmQva3ViZW5ldF90ZW1wbGF0ZS5jb25mIgogIFtwbHVnaW5zLiJpby5jb250YWluZXJkLmdycGMudjEuY3JpIi5yZWdpc3RyeV0KICAgIGNvbmZpZ19wYXRoID0gIi9ldGMvY29udGFpbmVyZC9jZXJ0cy5kIgogIFtwbHVnaW5zLiJpby5jb250YWluZXJkLmdycGMudjEuY3JpIi5yZWdpc3RyeS5oZWFkZXJzXQogICAgWC1NZXRhLVNvdXJjZS1DbGllbnQgPSBbImF6dXJlL2FrcyJdClttZXRyaWNzXQogIGFkZHJlc3MgPSAiMC4wLjAuMDoxMDI1NyIK
+ base64 -d
+ '[' -n '' ']'
+ tee /etc/sysctl.d/99-force-bridge-forward.conf
+ retrycmd_if_failure 120 5 25 sysctl --system
+ _retrycmd_internal 120 5 25 true sysctl --system
+ local retries=120
+ shift
+ local waitSleep=5
+ shift
+ local timeoutVal=25
+ shift
+ local shouldLog=true
+ shift
+ cmdToRun=('sysctl' '--system')
+ local cmdToRun
+ local exitStatus=0
++ seq 1 120
+ for i in $(seq 1 "$retries")
+ timeout 25 sysctl --system
* Applying /etc/sysctl.d/10-console-messages.conf ...
kernel.printk = 4 4 1 7
* Applying /etc/sysctl.d/10-ipv6-privacy.conf ...
net.ipv6.conf.all.use_tempaddr = 2
net.ipv6.conf.default.use_tempaddr = 2
* Applying /etc/sysctl.d/10-kernel-hardening.conf ...
kernel.kptr_restrict = 1
* Applying /etc/sysctl.d/10-magic-sysrq.conf ...
kernel.sysrq = 176
* Applying /etc/sysctl.d/10-network-security.conf ...
net.ipv4.conf.default.rp_filter = 2
net.ipv4.conf.all.rp_filter = 2
* Applying /etc/sysctl.d/10-ptrace.conf ...
kernel.yama.ptrace_scope = 1
* Applying /etc/sysctl.d/10-zeropage.conf ...
vm.mmap_min_addr = 65536
* Applying /usr/lib/sysctl.d/50-default.conf ...
kernel.core_uses_pid = 1
net.ipv4.conf.default.rp_filter = 2
net.ipv4.conf.default.accept_source_route = 0
sysctl: setting key "net.ipv4.conf.all.accept_source_route": Invalid argument
net.ipv4.conf.default.promote_secondaries = 1
sysctl: setting key "net.ipv4.conf.all.promote_secondaries": Invalid argument
net.ipv4.ping_group_range = 0 2147483647
net.core.default_qdisc = fq_codel
fs.protected_hardlinks = 1
fs.protected_symlinks = 1
fs.protected_regular = 1
fs.protected_fifos = 1
* Applying /usr/lib/sysctl.d/50-pid-max.conf ...
kernel.pid_max = 4194304
* Applying /etc/sysctl.d/60-CIS.conf ...
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
net.ipv6.conf.all.accept_source_route = 0
net.ipv6.conf.default.accept_source_route = 0
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.default.log_martians = 1
net.ipv6.conf.all.accept_ra = 0
net.ipv6.conf.default.accept_ra = 0
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.icmp_ignore_bogus_error_responses = 1
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1
net.ipv4.tcp_syncookies = 1
vm.overcommit_memory = 1
kernel.panic = 10
kernel.panic_on_oops = 1
kernel.pid_max = 4194304
fs.inotify.max_user_watches = 1048576
fs.inotify.max_user_instances = 1024
kernel.randomize_va_space = 2
fs.suid_dumpable = 0
* Applying /etc/sysctl.d/99-cloudimg-ipv6.conf ...
net.ipv6.conf.all.use_tempaddr = 0
net.ipv6.conf.default.use_tempaddr = 0
* Applying /etc/sysctl.d/99-cloudimg-udp.conf ...
net.core.rmem_max = 1048576
net.core.rmem_default = 1048576
* Applying /etc/sysctl.d/99-force-bridge-forward.conf ...
net.ipv4.ip_forward = 1
net.ipv4.conf.all.forwarding = 1
net.ipv6.conf.all.forwarding = 1
net.bridge.bridge-nf-call-iptables = 1
* Applying /usr/lib/sysctl.d/99-protect-links.conf ...
fs.protected_fifos = 1
fs.protected_hardlinks = 1
fs.protected_regular = 2
fs.protected_symlinks = 1
* Applying /etc/sysctl.d/99-sysctl.conf ...
* Applying /etc/sysctl.conf ...
+ exitStatus=0
+ '[' 0 -eq 0 ']'
+ break
+ '[' true = true ']'
+ '[' 0 -eq 0 ']'
+ echo 'Executed "sysctl --system" 1 times.'
Executed "sysctl --system" 1 times.
+ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
+ return 0
+ systemctlEnableAndStart containerd 30
+ service=containerd
+ timeout=30
+ systemctl_restart 100 5 30 containerd
+ _systemctl_retry_svc_operation 100 5 30 restart containerd true
+ retries=100
+ wait_sleep=5
+ timeout=30
+ operation=restart
+ svcname=containerd
+ shouldLogRetryInfo=true
++ seq 1 100
+ for i in $(seq 1 $retries)
+ timeout 30 systemctl daemon-reload
+ timeout 30 systemctl restart containerd
+ break
+ RESTART_STATUS=0
+ systemctl status containerd --no-pager -l
+ '[' 0 -ne 0 ']'
+ retrycmd_if_failure 120 5 25 systemctl enable containerd
+ _retrycmd_internal 120 5 25 true systemctl enable containerd
+ local retries=120
+ shift
+ local waitSleep=5
+ shift
+ local timeoutVal=25
+ shift
+ local shouldLog=true
+ shift
+ cmdToRun=('systemctl' 'enable' 'containerd')
+ local cmdToRun
+ local exitStatus=0
++ seq 1 120
+ for i in $(seq 1 "$retries")
+ timeout 25 systemctl enable containerd
+ exitStatus=0
+ '[' 0 -eq 0 ']'
+ break
+ '[' true = true ']'
+ '[' 0 -eq 0 ']'
+ echo 'Executed "systemctl enable containerd" 1 times.'
Executed "systemctl enable containerd" 1 times.
+ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
+ return 0
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:21.133'
++ jq -n --arg Timestamp '2025-11-12 21:55:20.086' --arg OperationId '2025-11-12 21:55:21.133' --arg Version 1.23 --arg TaskName AKS.CSE.ensureContainerd --arg EventLevel Informational --arg Message 'Completed: ensureContainerd' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:20.086",
  "OperationId": "2025-11-12 21:55:21.133",
  "Version": "1.23",
  "TaskName": "AKS.CSE.ensureContainerd",
  "EventLevel": "Informational",
  "Message": "Completed: ensureContainerd",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:20.086",' '"OperationId":' '"2025-11-12' '21:55:21.133",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.ensureContainerd",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'ensureContainerd",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ '[' -n '' ']'
+ '[' AzurePublicCloud = AzureChinaCloud ']'
+ '[' false = true ']'
+ '[' false = true ']'
+ '[' false = true ']'
+ '[' true = true ']'
+ tee /etc/systemd/system/kubelet.service.d/10-cgroupv2.conf
+ mkdir -p /etc/containerd
+ base64 -d
+ echo CnsKICAgICJjbmlWZXJzaW9uIjogIjAuMy4xIiwKICAgICJuYW1lIjogImt1YmVuZXQiLAogICAgInBsdWdpbnMiOiBbewogICAgInR5cGUiOiAiYnJpZGdlIiwKICAgICJicmlkZ2UiOiAiY2JyMCIsCiAgICAibXR1IjogMTUwMCwKICAgICJhZGRJZiI6ICJldGgwIiwKICAgICJpc0dhdGV3YXkiOiB0cnVlLAogICAgImlwTWFzcSI6IGZhbHNlLAogICAgInByb21pc2NNb2RlIjogdHJ1ZSwKICAgICJoYWlycGluTW9kZSI6IGZhbHNlLAogICAgImlwYW0iOiB7CiAgICAgICAgInR5cGUiOiAiaG9zdC1sb2NhbCIsCiAgICAgICAgInJhbmdlcyI6IFt7e3JhbmdlICRpLCAkcmFuZ2UgOj0gLlBvZENJRFJSYW5nZXN9fXt7aWYgJGl9fSwge3tlbmR9fVt7InN1Ym5ldCI6ICJ7eyRyYW5nZX19In1de3tlbmR9fV0sCiAgICAgICAgInJvdXRlcyI6IFt7e3JhbmdlICRpLCAkcm91dGUgOj0gLlJvdXRlc319e3tpZiAkaX19LCB7e2VuZH19eyJkc3QiOiAie3skcm91dGV9fSJ9e3tlbmR9fV0KICAgIH0KICAgIH0sCiAgICB7CiAgICAidHlwZSI6ICJwb3J0bWFwIiwKICAgICJjYXBhYmlsaXRpZXMiOiB7InBvcnRNYXBwaW5ncyI6IHRydWV9LAogICAgImV4dGVybmFsU2V0TWFya0NoYWluIjogIktVQkUtTUFSSy1NQVNRIgogICAgfV0KfQo=
+ tee /etc/systemd/system/kubelet.service.d/10-containerd-base-flag.conf
+ semverCompare 1.32.9 1.27.0
++ cut -d + -f 1
++ echo 1.32.9
++ cut -d '~' -f 1
+ VERSION_A=1.32.9
++ cut -d '~' -f 1
++ cut -d + -f 1
++ echo 1.27.0
+ VERSION_B=1.27.0
+ '[' 1.32.9 = 1.27.0 ']'
++ sort -V
++ tr ' ' '\n'
++ echo 1.32.9 1.27.0
+ sorted='1.27.0
1.32.9'
++ cut '-d
' -f2
++ IFS=
++ echo '1.27.0
1.32.9'
+ highestVersion=1.32.9
+ '[' 1.32.9 = 1.32.9 ']'
+ return 0
+ '[' false = true ']'
+ logs_to_events AKS.CSE.ensureSysctl ensureSysctl
+ local task=AKS.CSE.ensureSysctl
+ shift
++ date +%s%3N
+ local eventsFileName=1762984521197
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:21.199'
+ ensureSysctl
+ SYSCTL_CONFIG_FILE=/etc/sysctl.d/999-sysctl-aks.conf
++ dirname /etc/sysctl.d/999-sysctl-aks.conf
+ mkdir -p /etc/sysctl.d
+ touch /etc/sysctl.d/999-sysctl-aks.conf
+ chmod 0644 /etc/sysctl.d/999-sysctl-aks.conf
+ base64 -d
+ echo IyBUaGlzIGlzIGEgcGFydGlhbCB3b3JrYXJvdW5kIHRvIHRoaXMgdXBzdHJlYW0gS3ViZXJuZXRlcyBpc3N1ZToKIyBodHRwczovL2dpdGh1Yi5jb20va3ViZXJuZXRlcy9rdWJlcm5ldGVzL2lzc3Vlcy80MTkxNiNpc3N1ZWNvbW1lbnQtMzEyNDI4NzMxCm5ldC5pcHY0LnRjcF9yZXRyaWVzMj04Cm5ldC5jb3JlLm1lc3NhZ2VfYnVyc3Q9ODAKbmV0LmNvcmUubWVzc2FnZV9jb3N0PTQwCm5ldC5jb3JlLnNvbWF4Y29ubj0xNjM4NApuZXQuaXB2NC50Y3BfbWF4X3N5bl9iYWNrbG9nPTE2Mzg0Cm5ldC5pcHY0Lm5laWdoLmRlZmF1bHQuZ2NfdGhyZXNoMT00MDk2Cm5ldC5pcHY0Lm5laWdoLmRlZmF1bHQuZ2NfdGhyZXNoMj04MTkyCm5ldC5pcHY0Lm5laWdoLmRlZmF1bHQuZ2NfdGhyZXNoMz0xNjM4NAo=
+ retrycmd_if_failure 24 5 25 sysctl --system
+ _retrycmd_internal 24 5 25 true sysctl --system
+ local retries=24
+ shift
+ local waitSleep=5
+ shift
+ local timeoutVal=25
+ shift
+ local shouldLog=true
+ shift
+ cmdToRun=('sysctl' '--system')
+ local cmdToRun
+ local exitStatus=0
++ seq 1 24
+ for i in $(seq 1 "$retries")
+ timeout 25 sysctl --system
* Applying /etc/sysctl.d/10-console-messages.conf ...
kernel.printk = 4 4 1 7
* Applying /etc/sysctl.d/10-ipv6-privacy.conf ...
net.ipv6.conf.all.use_tempaddr = 2
net.ipv6.conf.default.use_tempaddr = 2
* Applying /etc/sysctl.d/10-kernel-hardening.conf ...
kernel.kptr_restrict = 1
* Applying /etc/sysctl.d/10-magic-sysrq.conf ...
kernel.sysrq = 176
* Applying /etc/sysctl.d/10-network-security.conf ...
net.ipv4.conf.default.rp_filter = 2
net.ipv4.conf.all.rp_filter = 2
* Applying /etc/sysctl.d/10-ptrace.conf ...
kernel.yama.ptrace_scope = 1
* Applying /etc/sysctl.d/10-zeropage.conf ...
vm.mmap_min_addr = 65536
* Applying /usr/lib/sysctl.d/50-default.conf ...
kernel.core_uses_pid = 1
net.ipv4.conf.default.rp_filter = 2
net.ipv4.conf.default.accept_source_route = 0
sysctl: setting key "net.ipv4.conf.all.accept_source_route": Invalid argument
net.ipv4.conf.default.promote_secondaries = 1
sysctl: setting key "net.ipv4.conf.all.promote_secondaries": Invalid argument
net.ipv4.ping_group_range = 0 2147483647
net.core.default_qdisc = fq_codel
fs.protected_hardlinks = 1
fs.protected_symlinks = 1
fs.protected_regular = 1
fs.protected_fifos = 1
* Applying /usr/lib/sysctl.d/50-pid-max.conf ...
kernel.pid_max = 4194304
* Applying /etc/sysctl.d/60-CIS.conf ...
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
net.ipv6.conf.all.accept_source_route = 0
net.ipv6.conf.default.accept_source_route = 0
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.default.log_martians = 1
net.ipv6.conf.all.accept_ra = 0
net.ipv6.conf.default.accept_ra = 0
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.icmp_ignore_bogus_error_responses = 1
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1
net.ipv4.tcp_syncookies = 1
vm.overcommit_memory = 1
kernel.panic = 10
kernel.panic_on_oops = 1
kernel.pid_max = 4194304
fs.inotify.max_user_watches = 1048576
fs.inotify.max_user_instances = 1024
kernel.randomize_va_space = 2
fs.suid_dumpable = 0
* Applying /etc/sysctl.d/99-cloudimg-ipv6.conf ...
net.ipv6.conf.all.use_tempaddr = 0
net.ipv6.conf.default.use_tempaddr = 0
* Applying /etc/sysctl.d/99-cloudimg-udp.conf ...
net.core.rmem_max = 1048576
net.core.rmem_default = 1048576
* Applying /etc/sysctl.d/99-force-bridge-forward.conf ...
net.ipv4.ip_forward = 1
net.ipv4.conf.all.forwarding = 1
net.ipv6.conf.all.forwarding = 1
net.bridge.bridge-nf-call-iptables = 1
* Applying /usr/lib/sysctl.d/99-protect-links.conf ...
fs.protected_fifos = 1
fs.protected_hardlinks = 1
fs.protected_regular = 2
fs.protected_symlinks = 1
* Applying /etc/sysctl.d/99-sysctl.conf ...
* Applying /etc/sysctl.d/999-sysctl-aks.conf ...
net.ipv4.tcp_retries2 = 8
net.core.message_burst = 80
net.core.message_cost = 40
net.core.somaxconn = 16384
net.ipv4.tcp_max_syn_backlog = 16384
net.ipv4.neigh.default.gc_thresh1 = 4096
net.ipv4.neigh.default.gc_thresh2 = 8192
net.ipv4.neigh.default.gc_thresh3 = 16384
* Applying /etc/sysctl.conf ...
+ exitStatus=0
+ '[' 0 -eq 0 ']'
+ break
+ '[' true = true ']'
+ '[' 0 -eq 0 ']'
+ echo 'Executed "sysctl --system" 1 times.'
Executed "sysctl --system" 1 times.
+ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
+ return 0
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:21.216'
++ jq -n --arg Timestamp '2025-11-12 21:55:21.199' --arg OperationId '2025-11-12 21:55:21.216' --arg Version 1.23 --arg TaskName AKS.CSE.ensureSysctl --arg EventLevel Informational --arg Message 'Completed: ensureSysctl' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:21.199",
  "OperationId": "2025-11-12 21:55:21.216",
  "Version": "1.23",
  "TaskName": "AKS.CSE.ensureSysctl",
  "EventLevel": "Informational",
  "Message": "Completed: ensureSysctl",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:21.199",' '"OperationId":' '"2025-11-12' '21:55:21.216",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.ensureSysctl",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'ensureSysctl",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ '[' false = true ']'
+ '[' true = true ']'
+ logs_to_events AKS.CSE.ensureNoDupOnPromiscuBridge ensureNoDupOnPromiscuBridge
+ local task=AKS.CSE.ensureNoDupOnPromiscuBridge
+ shift
++ date +%s%3N
+ local eventsFileName=1762984521261
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:21.263'
+ ensureNoDupOnPromiscuBridge
+ systemctlEnableAndStart ensure-no-dup 30
+ service=ensure-no-dup
+ timeout=30
+ systemctl_restart 100 5 30 ensure-no-dup
+ _systemctl_retry_svc_operation 100 5 30 restart ensure-no-dup true
+ retries=100
+ wait_sleep=5
+ timeout=30
+ operation=restart
+ svcname=ensure-no-dup
+ shouldLogRetryInfo=true
++ seq 1 100
+ for i in $(seq 1 $retries)
+ timeout 30 systemctl daemon-reload
+ timeout 30 systemctl restart ensure-no-dup
+ break
+ RESTART_STATUS=0
+ systemctl status ensure-no-dup --no-pager -l
+ '[' 0 -ne 0 ']'
+ retrycmd_if_failure 120 5 25 systemctl enable ensure-no-dup
+ _retrycmd_internal 120 5 25 true systemctl enable ensure-no-dup
+ local retries=120
+ shift
+ local waitSleep=5
+ shift
+ local timeoutVal=25
+ shift
+ local shouldLog=true
+ shift
+ cmdToRun=('systemctl' 'enable' 'ensure-no-dup')
+ local cmdToRun
+ local exitStatus=0
++ seq 1 120
+ for i in $(seq 1 "$retries")
+ timeout 25 systemctl enable ensure-no-dup
The unit files have no installation config (WantedBy=, RequiredBy=, Also=,
Alias= settings in the [Install] section, and DefaultInstance= for template
units). This means they are not meant to be enabled using systemctl.
 
Possible reasons for having this kind of units are:
 A unit may be statically enabled by being symlinked from another unit's
  .wants/ or .requires/ directory.
 A unit's purpose may be to act as a helper for some other unit which has
  a requirement dependency on it.
 A unit may be started when needed via activation (socket, path, timer,
  D-Bus, udev, scripted systemctl call, ...).
 In case of template units, the unit is meant to be enabled with some
  instance name specified.
+ exitStatus=0
+ '[' 0 -eq 0 ']'
+ break
+ '[' true = true ']'
+ '[' 0 -eq 0 ']'
+ echo 'Executed "systemctl enable ensure-no-dup" 1 times.'
Executed "systemctl enable ensure-no-dup" 1 times.
+ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
+ return 0
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:22.014'
++ jq -n --arg Timestamp '2025-11-12 21:55:21.263' --arg OperationId '2025-11-12 21:55:22.014' --arg Version 1.23 --arg TaskName AKS.CSE.ensureNoDupOnPromiscuBridge --arg EventLevel Informational --arg Message 'Completed: ensureNoDupOnPromiscuBridge' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:21.263",
  "OperationId": "2025-11-12 21:55:22.014",
  "Version": "1.23",
  "TaskName": "AKS.CSE.ensureNoDupOnPromiscuBridge",
  "EventLevel": "Informational",
  "Message": "Completed: ensureNoDupOnPromiscuBridge",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:21.263",' '"OperationId":' '"2025-11-12' '21:55:22.014",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.ensureNoDupOnPromiscuBridge",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'ensureNoDupOnPromiscuBridge",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ isAzureLinuxOSGuard UBUNTU ''
+ local os=UBUNTU
+ local os_variant=
+ '[' UBUNTU = AZURELINUX ']'
+ return 1
+ '[' UBUNTU = UBUNTU ']'
+ logs_to_events AKS.CSE.ubuntuSnapshotUpdate ensureSnapshotUpdate
+ local task=AKS.CSE.ubuntuSnapshotUpdate
+ shift
++ date +%s%3N
+ local eventsFileName=1762984522048
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:22.050'
+ ensureSnapshotUpdate
+ systemctlEnableAndStart snapshot-update.timer 30
+ service=snapshot-update.timer
+ timeout=30
+ systemctl_restart 100 5 30 snapshot-update.timer
+ _systemctl_retry_svc_operation 100 5 30 restart snapshot-update.timer true
+ retries=100
+ wait_sleep=5
+ timeout=30
+ operation=restart
+ svcname=snapshot-update.timer
+ shouldLogRetryInfo=true
++ seq 1 100
+ for i in $(seq 1 $retries)
+ timeout 30 systemctl daemon-reload
+ timeout 30 systemctl restart snapshot-update.timer
+ break
+ RESTART_STATUS=0
+ systemctl status snapshot-update.timer --no-pager -l
+ '[' 0 -ne 0 ']'
+ retrycmd_if_failure 120 5 25 systemctl enable snapshot-update.timer
+ _retrycmd_internal 120 5 25 true systemctl enable snapshot-update.timer
+ local retries=120
+ shift
+ local waitSleep=5
+ shift
+ local timeoutVal=25
+ shift
+ local shouldLog=true
+ shift
+ cmdToRun=('systemctl' 'enable' 'snapshot-update.timer')
+ local cmdToRun
+ local exitStatus=0
++ seq 1 120
+ for i in $(seq 1 "$retries")
+ timeout 25 systemctl enable snapshot-update.timer
Created symlink /etc/systemd/system/multi-user.target.wants/snapshot-update.timer  /etc/systemd/system/snapshot-update.timer.
+ exitStatus=0
+ '[' 0 -eq 0 ']'
+ break
+ '[' true = true ']'
+ '[' 0 -eq 0 ']'
+ echo 'Executed "systemctl enable snapshot-update.timer" 1 times.'
Executed "systemctl enable snapshot-update.timer" 1 times.
+ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
+ return 0
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:22.795'
++ jq -n --arg Timestamp '2025-11-12 21:55:22.050' --arg OperationId '2025-11-12 21:55:22.795' --arg Version 1.23 --arg TaskName AKS.CSE.ubuntuSnapshotUpdate --arg EventLevel Informational --arg Message 'Completed: ensureSnapshotUpdate' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:22.050",
  "OperationId": "2025-11-12 21:55:22.795",
  "Version": "1.23",
  "TaskName": "AKS.CSE.ubuntuSnapshotUpdate",
  "EventLevel": "Informational",
  "Message": "Completed: ensureSnapshotUpdate",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:22.050",' '"OperationId":' '"2025-11-12' '21:55:22.795",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.ubuntuSnapshotUpdate",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'ensureSnapshotUpdate",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ '[' false = true ']'
+ '[' false = true ']'
+ logs_to_events AKS.CSE.enableLocalDNS enableLocalDNS
+ local task=AKS.CSE.enableLocalDNS
+ shift
++ date +%s%3N
+ local eventsFileName=1762984522825
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:22.827'
+ enableLocalDNS
+ '[' '!' -f /opt/azure/containers/localdns/localdns.corefile ']'
+ '[' '!' -s /opt/azure/containers/localdns/localdns.corefile ']'
+ echo 'localdns should be enabled.'
localdns should be enabled.
+ systemctlEnableAndStart localdns 30
+ service=localdns
+ timeout=30
+ systemctl_restart 100 5 30 localdns
+ _systemctl_retry_svc_operation 100 5 30 restart localdns true
+ retries=100
+ wait_sleep=5
+ timeout=30
+ operation=restart
+ svcname=localdns
+ shouldLogRetryInfo=true
++ seq 1 100
+ for i in $(seq 1 $retries)
+ timeout 30 systemctl daemon-reload
+ timeout 30 systemctl restart localdns
walinuxagent was already set on hold.
+ exitStatus=0
+ '[' 0 -eq 0 ']'
+ break
+ '[' true = true ']'
+ '[' 0 -eq 0 ']'
+ echo 'Executed "apt-mark hold walinuxagent" 1 times.'
Executed "apt-mark hold walinuxagent" 1 times.
+ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
+ return 0
++ date
++ hostname
+ echo Wed Nov 12 21:55:26 UTC 2025,88t8-2025-11-12-ubuntu2204000000, endAptmarkWALinuxAgent hold
Wed Nov 12 21:55:26 UTC 2025,88t8-2025-11-12-ubuntu2204000000, endAptmarkWALinuxAgent hold
+ break
+ RESTART_STATUS=0
+ systemctl status localdns --no-pager -l
+ '[' 0 -ne 0 ']'
+ retrycmd_if_failure 120 5 25 systemctl enable localdns
+ _retrycmd_internal 120 5 25 true systemctl enable localdns
+ local retries=120
+ shift
+ local waitSleep=5
+ shift
+ local timeoutVal=25
+ shift
+ local shouldLog=true
+ shift
+ cmdToRun=('systemctl' 'enable' 'localdns')
+ local cmdToRun
+ local exitStatus=0
++ seq 1 120
+ for i in $(seq 1 "$retries")
+ timeout 25 systemctl enable localdns
Created symlink /etc/systemd/system/multi-user.target.wants/localdns.service  /etc/systemd/system/localdns.service.
+ exitStatus=0
+ '[' 0 -eq 0 ']'
+ break
+ '[' true = true ']'
+ '[' 0 -eq 0 ']'
+ echo 'Executed "systemctl enable localdns" 1 times.'
Executed "systemctl enable localdns" 1 times.
+ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
+ return 0
+ echo 'Enable localdns succeeded.'
Enable localdns succeeded.
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:27.648'
++ jq -n --arg Timestamp '2025-11-12 21:55:22.827' --arg OperationId '2025-11-12 21:55:27.648' --arg Version 1.23 --arg TaskName AKS.CSE.enableLocalDNS --arg EventLevel Informational --arg Message 'Completed: enableLocalDNS' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:22.827",
  "OperationId": "2025-11-12 21:55:27.648",
  "Version": "1.23",
  "TaskName": "AKS.CSE.enableLocalDNS",
  "EventLevel": "Informational",
  "Message": "Completed: enableLocalDNS",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:22.827",' '"OperationId":' '"2025-11-12' '21:55:27.648",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.enableLocalDNS",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'enableLocalDNS",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ '[' '' = true ']'
+ '[' ubuntu '!=' mariner ']'
+ '[' ubuntu '!=' azurelinux ']'
++ date
+ echo 'Recreating man-db auto-update flag file and kicking off man-db update process at Wed Nov 12 21:55:27 UTC 2025'
Recreating man-db auto-update flag file and kicking off man-db update process at Wed Nov 12 21:55:27 UTC 2025
+ createManDbAutoUpdateFlagFile
+ touch /var/lib/man-db/auto-update
+ '[' false '!=' true ']'
+ nodePrep
+ logs_to_events AKS.CSE.configureKubeletServing configureKubeletServing
+ local task=AKS.CSE.configureKubeletServing
+ shift
++ date +%s%3N
+ local eventsFileName=1762984527685
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:27.687'
+ configureKubeletServing
+ '[' false '!=' true ']'
+ echo 'kubelet serving certificate rotation is disabled, generating self-signed serving certificate with openssl'
kubelet serving certificate rotation is disabled, generating self-signed serving certificate with openssl
+ generateSelfSignedKubeletServingCertificate
+ mkdir -p /etc/kubernetes/certs
+ /usr/bin/mandb
+ KUBELET_SERVER_PRIVATE_KEY_PATH=/etc/kubernetes/certs/kubeletserver.key
+ KUBELET_SERVER_CERT_PATH=/etc/kubernetes/certs/kubeletserver.crt
+ openssl genrsa -out /etc/kubernetes/certs/kubeletserver.key 2048
+ openssl req -new -x509 -days 7300 -key /etc/kubernetes/certs/kubeletserver.key -out /etc/kubernetes/certs/kubeletserver.crt -subj /CN=88t8-2025-11-12-ubuntu2204000000 -addext subjectAltName=DNS:88t8-2025-11-12-ubuntu2204000000
+ return 0
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:27.803'
++ jq -n --arg Timestamp '2025-11-12 21:55:27.687' --arg OperationId '2025-11-12 21:55:27.803' --arg Version 1.23 --arg TaskName AKS.CSE.configureKubeletServing --arg EventLevel Informational --arg Message 'Completed: configureKubeletServing' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:27.687",
  "OperationId": "2025-11-12 21:55:27.803",
  "Version": "1.23",
  "TaskName": "AKS.CSE.configureKubeletServing",
  "EventLevel": "Informational",
  "Message": "Completed: configureKubeletServing",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:27.687",' '"OperationId":' '"2025-11-12' '21:55:27.803",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.configureKubeletServing",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'configureKubeletServing",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ logs_to_events AKS.CSE.configureK8s configureK8s
+ local task=AKS.CSE.configureK8s
+ shift
++ date +%s%3N
+ local eventsFileName=1762984527821
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:27.822'
+ configureK8s
+ mkdir -p /etc/kubernetes/certs
+ mkdir -p /etc/systemd/system/kubelet.service.d
+ '[' -n '' ']'
+ set +x
+ '[' false = true ']'
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:27.826'
++ jq -n --arg Timestamp '2025-11-12 21:55:27.822' --arg OperationId '2025-11-12 21:55:27.826' --arg Version 1.23 --arg TaskName AKS.CSE.configureK8s --arg EventLevel Informational --arg Message 'Completed: configureK8s' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:27.822",
  "OperationId": "2025-11-12 21:55:27.826",
  "Version": "1.23",
  "TaskName": "AKS.CSE.configureK8s",
  "EventLevel": "Informational",
  "Message": "Completed: configureK8s",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:27.822",' '"OperationId":' '"2025-11-12' '21:55:27.826",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.configureK8s",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'configureK8s",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ '[' false = true ']'
+ '[' -n 'curl -v --insecure --proxy-insecure https://mcr.microsoft.com/v2/' ']'
+ local outbound_log=/var/log/azure/cluster-provision-cse-output.log
+ '[' -n 'export NO_PROXY=localhost,127.0.0.1,168.63.129.16,169.254.169.254,10.0.0.0/16,agentbaker-agentbaker-e2e-t-8ecadf-c82d8251.hcp.eastus.azmk8s.io; ' ']'
+ eval export 'NO_PROXY=localhost,127.0.0.1,168.63.129.16,169.254.169.254,10.0.0.0/16,agentbaker-agentbaker-e2e-t-8ecadf-c82d8251.hcp.eastus.azmk8s.io;'
++ export NO_PROXY=localhost,127.0.0.1,168.63.129.16,169.254.169.254,10.0.0.0/16,agentbaker-agentbaker-e2e-t-8ecadf-c82d8251.hcp.eastus.azmk8s.io
++ NO_PROXY=localhost,127.0.0.1,168.63.129.16,169.254.169.254,10.0.0.0/16,agentbaker-agentbaker-e2e-t-8ecadf-c82d8251.hcp.eastus.azmk8s.io
+ retrycmd_if_failure 60 1 5 curl -v --insecure --proxy-insecure https://mcr.microsoft.com/v2/
+ '[' -n '' ']'
+ export -f should_skip_nvidia_drivers
++ retrycmd_silent 10 1 10 bash -cx should_skip_nvidia_drivers
++ _retrycmd_internal 10 1 10 false bash -cx should_skip_nvidia_drivers
++ local retries=10
++ shift
++ local waitSleep=1
++ shift
++ local timeoutVal=10
++ shift
++ local shouldLog=false
++ shift
++ cmdToRun=('bash' '-cx' 'should_skip_nvidia_drivers')
++ local cmdToRun
++ local exitStatus=0
+++ seq 1 10
++ for i in $(seq 1 "$retries")
++ timeout 10 bash -cx should_skip_nvidia_drivers
+ should_skip_nvidia_drivers
+ set -x
++ curl -fsSL -H 'Metadata: true' --noproxy '*' 'http://169.254.169.254/metadata/instance?api-version=2021-02-01'
+ body='{"compute":{"azEnvironment":"AzurePublicCloud","customData":"","evictionPolicy":"","isHostCompatibilityLayerVm":"false","licenseType":"","location":"westus2","name":"88t8-2025-11-12-ubuntu2204_0","offer":"","osProfile":{"adminUsername":"azureuser","computerName":"88t8-2025-11-12-ubuntu2204000000","disablePasswordAuthentication":"true"},"osType":"Linux","placementGroupId":"c61ccfee-96ef-40f5-a960-3f4b85676bcb","plan":{"name":"","product":"","publisher":""},"platformFaultDomain":"0","platformUpdateDomain":"0","priority":"","provider":"Microsoft.Compute","publicKeys":[{"keyData":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC8i1dJi2pq3jYOaEYIJnM4/Lggs7Sa26Q3aAWy8GRB3qJUzINbkOJgOMWGnN2mnRHJTKqBKttXs8A8NCoUE1FwNve70gfGnoo1tLjF/hkaITsAfDm0+Clk6p4a26SkbjqdkHexNrcbn4JqY6EJqLvYd7PtjSREB+Ky+IJghdHem5RJxSs4/MrbvcNe2hPJgF9vcTJfjiLbGsR1cwWg0pBdlIY73BJnWdNlHrpCoxlYgnb8OJuqGv3vjw9RKCBfa/rzh4qZuR4L0SrFX+Pu3OS1aRT/Z5PS1Nwg8rW7NC+E9rsL0+yBt1+7qUrLxU4arq/vyqAxH+DCa+Qvu174BAkYVyA4y2BmLI2Wdw6qgRmtjZTJcH2zXCYRx1L1qp7FngXCDNDE1diDKSdazv9/YQNyIwxzqAKU5bsWM7Lo72mDiae1r8z61tfHFOMAQi/Hkz5RFbwt/4gjQGadxf2x7b7sMGSeqFjXxPvTf2ylVyll0113j3jEL6ho5GvlKPsftvlT7ClrV0cCquZkZ3pZYDX7TE1zlnvkLloh/Iir/Uq6KacPc4Y3kKTK6hRpXVCbzwlapHFHQXGqvZ12EjIfp9WpF1YXLVrStoM3DCpCeqLn11gsTF/6v9Z0ZaYsSrQuBxqFefDNoA7B7djm5wdOHOfXsT/ygXooBW660s4GeKfDTw==\n","path":"/home/azureuser/.ssh/authorized_keys"}],"publisher":"","resourceGroupName":"MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2","resourceId":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/virtualMachineScaleSets/88t8-2025-11-12-ubuntu2204/virtualMachines/0","securityProfile":{"secureBootEnabled":"false","virtualTpmEnabled":"false"},"sku":"","storageProfile":{"dataDisks":[],"imageReference":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/packer/providers/Microsoft.Compute/galleries/akse2esig/images/aks-ubuntu-containerd-22.04-gen2/versions/1.1762806891.5705","offer":"","publisher":"","sku":"","version":""},"osDisk":{"caching":"ReadOnly","createOption":"FromImage","diffDiskSettings":{"option":"Local"},"diskSizeGB":"50","encryptionSettings":{"enabled":"false"},"image":{"uri":""},"managedDisk":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/disks/88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","storageAccountType":"Standard_LRS"},"name":"88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","osType":"Linux","vhd":{"uri":""},"writeAcceleratorEnabled":"false"},"resourceDisk":{"size":"0"}},"subscriptionId":"0660fddc-d191-4bad-b922-e69492903e0a","tags":"KEEP_VMSS:true;buildID:local;owner:e2e","tagsList":[{"name":"KEEP_VMSS","value":"true"},{"name":"buildID","value":"local"},{"name":"owner","value":"e2e"}],"userData":"","version":"1.1762806891.5705","vmId":"8b8bafc0-8aec-4bde-9f61-7069689d3ea6","vmScaleSetName":"88t8-2025-11-12-ubuntu2204","vmSize":"Standard_D2ads_v6","zone":""},"network":{"interface":[{"ipv4":{"ipAddress":[{"privateIpAddress":"10.224.0.7","publicIpAddress":""}],"subnet":[{"address":"10.224.0.0","prefix":"16"}]},"ipv6":{"ipAddress":[]},"macAddress":"000D3AFE890C"}]}}'
+ ret=0
+ '[' 0 -ne 0 ']'
++ jq -e '.compute.tagsList | map(select(.name | test("SkipGpuDriverInstall"; "i")))[0].value // "false" | test("true"; "i")'
++ echo '{"compute":{"azEnvironment":"AzurePublicCloud","customData":"","evictionPolicy":"","isHostCompatibilityLayerVm":"false","licenseType":"","location":"westus2","name":"88t8-2025-11-12-ubuntu2204_0","offer":"","osProfile":{"adminUsername":"azureuser","computerName":"88t8-2025-11-12-ubuntu2204000000","disablePasswordAuthentication":"true"},"osType":"Linux","placementGroupId":"c61ccfee-96ef-40f5-a960-3f4b85676bcb","plan":{"name":"","product":"","publisher":""},"platformFaultDomain":"0","platformUpdateDomain":"0","priority":"","provider":"Microsoft.Compute","publicKeys":[{"keyData":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC8i1dJi2pq3jYOaEYIJnM4/Lggs7Sa26Q3aAWy8GRB3qJUzINbkOJgOMWGnN2mnRHJTKqBKttXs8A8NCoUE1FwNve70gfGnoo1tLjF/hkaITsAfDm0+Clk6p4a26SkbjqdkHexNrcbn4JqY6EJqLvYd7PtjSREB+Ky+IJghdHem5RJxSs4/MrbvcNe2hPJgF9vcTJfjiLbGsR1cwWg0pBdlIY73BJnWdNlHrpCoxlYgnb8OJuqGv3vjw9RKCBfa/rzh4qZuR4L0SrFX+Pu3OS1aRT/Z5PS1Nwg8rW7NC+E9rsL0+yBt1+7qUrLxU4arq/vyqAxH+DCa+Qvu174BAkYVyA4y2BmLI2Wdw6qgRmtjZTJcH2zXCYRx1L1qp7FngXCDNDE1diDKSdazv9/YQNyIwxzqAKU5bsWM7Lo72mDiae1r8z61tfHFOMAQi/Hkz5RFbwt/4gjQGadxf2x7b7sMGSeqFjXxPvTf2ylVyll0113j3jEL6ho5GvlKPsftvlT7ClrV0cCquZkZ3pZYDX7TE1zlnvkLloh/Iir/Uq6KacPc4Y3kKTK6hRpXVCbzwlapHFHQXGqvZ12EjIfp9WpF1YXLVrStoM3DCpCeqLn11gsTF/6v9Z0ZaYsSrQuBxqFefDNoA7B7djm5wdOHOfXsT/ygXooBW660s4GeKfDTw==\n","path":"/home/azureuser/.ssh/authorized_keys"}],"publisher":"","resourceGroupName":"MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2","resourceId":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/virtualMachineScaleSets/88t8-2025-11-12-ubuntu2204/virtualMachines/0","securityProfile":{"secureBootEnabled":"false","virtualTpmEnabled":"false"},"sku":"","storageProfile":{"dataDisks":[],"imageReference":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/packer/providers/Microsoft.Compute/galleries/akse2esig/images/aks-ubuntu-containerd-22.04-gen2/versions/1.1762806891.5705","offer":"","publisher":"","sku":"","version":""},"osDisk":{"caching":"ReadOnly","createOption":"FromImage","diffDiskSettings":{"option":"Local"},"diskSizeGB":"50","encryptionSettings":{"enabled":"false"},"image":{"uri":""},"managedDisk":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/disks/88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","storageAccountType":"Standard_LRS"},"name":"88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","osType":"Linux","vhd":{"uri":""},"writeAcceleratorEnabled":"false"},"resourceDisk":{"size":"0"}},"subscriptionId":"0660fddc-d191-4bad-b922-e69492903e0a","tags":"KEEP_VMSS:true;buildID:local;owner:e2e","tagsList":[{"name":"KEEP_VMSS","value":"true"},{"name":"buildID","value":"local"},{"name":"owner","value":"e2e"}],"userData":"","version":"1.1762806891.5705","vmId":"8b8bafc0-8aec-4bde-9f61-7069689d3ea6","vmScaleSetName":"88t8-2025-11-12-ubuntu2204","vmSize":"Standard_D2ads_v6","zone":""},"network":{"interface":[{"ipv4":{"ipAddress":[{"privateIpAddress":"10.224.0.7","publicIpAddress":""}],"subnet":[{"address":"10.224.0.0","prefix":"16"}]},"ipv6":{"ipAddress":[]},"macAddress":"000D3AFE890C"}]}}'
+ should_skip=false
+ echo false
++ exitStatus=0
++ '[' 0 -eq 0 ']'
++ break
++ '[' false = true ']'
++ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
++ return 0
+ skip_nvidia_driver_install=false
+ '[' 0 -ne 0 ']'
+ REBOOTREQUIRED=false
+ '[' false '!=' true ']'
+ logs_to_events AKS.CSE.cleanUpGPUDrivers cleanUpGPUDrivers
+ local task=AKS.CSE.cleanUpGPUDrivers
+ shift
++ date +%s%3N
+ local eventsFileName=1762984527933
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:27.935'
+ cleanUpGPUDrivers
+ rm -Rf /usr/local/nvidia /opt/gpu
++ managedGPUPackageList
++ packages=(nvidia-device-plugin datacenter-gpu-manager-4-core datacenter-gpu-manager-4-proprietary datacenter-gpu-manager-exporter)
++ echo nvidia-device-plugin datacenter-gpu-manager-4-core datacenter-gpu-manager-4-proprietary datacenter-gpu-manager-exporter
+ for packageName in $(managedGPUPackageList)
+ rm -rf /opt/nvidia-device-plugin
+ for packageName in $(managedGPUPackageList)
+ rm -rf /opt/datacenter-gpu-manager-4-core
+ for packageName in $(managedGPUPackageList)
+ rm -rf /opt/datacenter-gpu-manager-4-proprietary
+ for packageName in $(managedGPUPackageList)
+ rm -rf /opt/datacenter-gpu-manager-exporter
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:28.047'
++ jq -n --arg Timestamp '2025-11-12 21:55:27.935' --arg OperationId '2025-11-12 21:55:28.047' --arg Version 1.23 --arg TaskName AKS.CSE.cleanUpGPUDrivers --arg EventLevel Informational --arg Message 'Completed: cleanUpGPUDrivers' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:27.935",
  "OperationId": "2025-11-12 21:55:28.047",
  "Version": "1.23",
  "TaskName": "AKS.CSE.cleanUpGPUDrivers",
  "EventLevel": "Informational",
  "Message": "Completed: cleanUpGPUDrivers",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:27.935",' '"OperationId":' '"2025-11-12' '21:55:28.047",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.cleanUpGPUDrivers",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'cleanUpGPUDrivers",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ '[' false = true ']'
+ export -f enableManagedGPUExperience
++ retrycmd_silent 10 1 10 bash -cx enableManagedGPUExperience
++ _retrycmd_internal 10 1 10 false bash -cx enableManagedGPUExperience
++ local retries=10
++ shift
++ local waitSleep=1
++ shift
++ local timeoutVal=10
++ shift
++ local shouldLog=false
++ shift
++ cmdToRun=('bash' '-cx' 'enableManagedGPUExperience')
++ local cmdToRun
++ local exitStatus=0
+++ seq 1 10
++ for i in $(seq 1 "$retries")
++ timeout 10 bash -cx enableManagedGPUExperience
+ enableManagedGPUExperience
+ set -x
++ curl -fsSL -H 'Metadata: true' --noproxy '*' 'http://169.254.169.254/metadata/instance?api-version=2021-02-01'
+ body='{"compute":{"azEnvironment":"AzurePublicCloud","customData":"","evictionPolicy":"","isHostCompatibilityLayerVm":"false","licenseType":"","location":"westus2","name":"88t8-2025-11-12-ubuntu2204_0","offer":"","osProfile":{"adminUsername":"azureuser","computerName":"88t8-2025-11-12-ubuntu2204000000","disablePasswordAuthentication":"true"},"osType":"Linux","placementGroupId":"c61ccfee-96ef-40f5-a960-3f4b85676bcb","plan":{"name":"","product":"","publisher":""},"platformFaultDomain":"0","platformUpdateDomain":"0","priority":"","provider":"Microsoft.Compute","publicKeys":[{"keyData":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC8i1dJi2pq3jYOaEYIJnM4/Lggs7Sa26Q3aAWy8GRB3qJUzINbkOJgOMWGnN2mnRHJTKqBKttXs8A8NCoUE1FwNve70gfGnoo1tLjF/hkaITsAfDm0+Clk6p4a26SkbjqdkHexNrcbn4JqY6EJqLvYd7PtjSREB+Ky+IJghdHem5RJxSs4/MrbvcNe2hPJgF9vcTJfjiLbGsR1cwWg0pBdlIY73BJnWdNlHrpCoxlYgnb8OJuqGv3vjw9RKCBfa/rzh4qZuR4L0SrFX+Pu3OS1aRT/Z5PS1Nwg8rW7NC+E9rsL0+yBt1+7qUrLxU4arq/vyqAxH+DCa+Qvu174BAkYVyA4y2BmLI2Wdw6qgRmtjZTJcH2zXCYRx1L1qp7FngXCDNDE1diDKSdazv9/YQNyIwxzqAKU5bsWM7Lo72mDiae1r8z61tfHFOMAQi/Hkz5RFbwt/4gjQGadxf2x7b7sMGSeqFjXxPvTf2ylVyll0113j3jEL6ho5GvlKPsftvlT7ClrV0cCquZkZ3pZYDX7TE1zlnvkLloh/Iir/Uq6KacPc4Y3kKTK6hRpXVCbzwlapHFHQXGqvZ12EjIfp9WpF1YXLVrStoM3DCpCeqLn11gsTF/6v9Z0ZaYsSrQuBxqFefDNoA7B7djm5wdOHOfXsT/ygXooBW660s4GeKfDTw==\n","path":"/home/azureuser/.ssh/authorized_keys"}],"publisher":"","resourceGroupName":"MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2","resourceId":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/virtualMachineScaleSets/88t8-2025-11-12-ubuntu2204/virtualMachines/0","securityProfile":{"secureBootEnabled":"false","virtualTpmEnabled":"false"},"sku":"","storageProfile":{"dataDisks":[],"imageReference":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/packer/providers/Microsoft.Compute/galleries/akse2esig/images/aks-ubuntu-containerd-22.04-gen2/versions/1.1762806891.5705","offer":"","publisher":"","sku":"","version":""},"osDisk":{"caching":"ReadOnly","createOption":"FromImage","diffDiskSettings":{"option":"Local"},"diskSizeGB":"50","encryptionSettings":{"enabled":"false"},"image":{"uri":""},"managedDisk":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/disks/88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","storageAccountType":"Standard_LRS"},"name":"88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","osType":"Linux","vhd":{"uri":""},"writeAcceleratorEnabled":"false"},"resourceDisk":{"size":"0"}},"subscriptionId":"0660fddc-d191-4bad-b922-e69492903e0a","tags":"KEEP_VMSS:true;buildID:local;owner:e2e","tagsList":[{"name":"KEEP_VMSS","value":"true"},{"name":"buildID","value":"local"},{"name":"owner","value":"e2e"}],"userData":"","version":"1.1762806891.5705","vmId":"8b8bafc0-8aec-4bde-9f61-7069689d3ea6","vmScaleSetName":"88t8-2025-11-12-ubuntu2204","vmSize":"Standard_D2ads_v6","zone":""},"network":{"interface":[{"ipv4":{"ipAddress":[{"privateIpAddress":"10.224.0.7","publicIpAddress":""}],"subnet":[{"address":"10.224.0.0","prefix":"16"}]},"ipv6":{"ipAddress":[]},"macAddress":"000D3AFE890C"}]}}'
+ ret=0
+ '[' 0 -ne 0 ']'
++ jq -r '.compute.tagsList[] | select(.name == "EnableManagedGPUExperience") | .value'
++ echo '{"compute":{"azEnvironment":"AzurePublicCloud","customData":"","evictionPolicy":"","isHostCompatibilityLayerVm":"false","licenseType":"","location":"westus2","name":"88t8-2025-11-12-ubuntu2204_0","offer":"","osProfile":{"adminUsername":"azureuser","computerName":"88t8-2025-11-12-ubuntu2204000000","disablePasswordAuthentication":"true"},"osType":"Linux","placementGroupId":"c61ccfee-96ef-40f5-a960-3f4b85676bcb","plan":{"name":"","product":"","publisher":""},"platformFaultDomain":"0","platformUpdateDomain":"0","priority":"","provider":"Microsoft.Compute","publicKeys":[{"keyData":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC8i1dJi2pq3jYOaEYIJnM4/Lggs7Sa26Q3aAWy8GRB3qJUzINbkOJgOMWGnN2mnRHJTKqBKttXs8A8NCoUE1FwNve70gfGnoo1tLjF/hkaITsAfDm0+Clk6p4a26SkbjqdkHexNrcbn4JqY6EJqLvYd7PtjSREB+Ky+IJghdHem5RJxSs4/MrbvcNe2hPJgF9vcTJfjiLbGsR1cwWg0pBdlIY73BJnWdNlHrpCoxlYgnb8OJuqGv3vjw9RKCBfa/rzh4qZuR4L0SrFX+Pu3OS1aRT/Z5PS1Nwg8rW7NC+E9rsL0+yBt1+7qUrLxU4arq/vyqAxH+DCa+Qvu174BAkYVyA4y2BmLI2Wdw6qgRmtjZTJcH2zXCYRx1L1qp7FngXCDNDE1diDKSdazv9/YQNyIwxzqAKU5bsWM7Lo72mDiae1r8z61tfHFOMAQi/Hkz5RFbwt/4gjQGadxf2x7b7sMGSeqFjXxPvTf2ylVyll0113j3jEL6ho5GvlKPsftvlT7ClrV0cCquZkZ3pZYDX7TE1zlnvkLloh/Iir/Uq6KacPc4Y3kKTK6hRpXVCbzwlapHFHQXGqvZ12EjIfp9WpF1YXLVrStoM3DCpCeqLn11gsTF/6v9Z0ZaYsSrQuBxqFefDNoA7B7djm5wdOHOfXsT/ygXooBW660s4GeKfDTw==\n","path":"/home/azureuser/.ssh/authorized_keys"}],"publisher":"","resourceGroupName":"MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2","resourceId":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/virtualMachineScaleSets/88t8-2025-11-12-ubuntu2204/virtualMachines/0","securityProfile":{"secureBootEnabled":"false","virtualTpmEnabled":"false"},"sku":"","storageProfile":{"dataDisks":[],"imageReference":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/packer/providers/Microsoft.Compute/galleries/akse2esig/images/aks-ubuntu-containerd-22.04-gen2/versions/1.1762806891.5705","offer":"","publisher":"","sku":"","version":""},"osDisk":{"caching":"ReadOnly","createOption":"FromImage","diffDiskSettings":{"option":"Local"},"diskSizeGB":"50","encryptionSettings":{"enabled":"false"},"image":{"uri":""},"managedDisk":{"id":"/subscriptions/0660fddc-d191-4bad-b922-e69492903e0a/resourceGroups/MC_abe2e-westus2_abe2e-kubenet-v2-711cd_westus2/providers/Microsoft.Compute/disks/88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","storageAccountType":"Standard_LRS"},"name":"88t8-2025-11-12-ubun88t8-2025-11-12-ubuntOS__1_0782a69727014548bff1e790e56bef2d","osType":"Linux","vhd":{"uri":""},"writeAcceleratorEnabled":"false"},"resourceDisk":{"size":"0"}},"subscriptionId":"0660fddc-d191-4bad-b922-e69492903e0a","tags":"KEEP_VMSS:true;buildID:local;owner:e2e","tagsList":[{"name":"KEEP_VMSS","value":"true"},{"name":"buildID","value":"local"},{"name":"owner","value":"e2e"}],"userData":"","version":"1.1762806891.5705","vmId":"8b8bafc0-8aec-4bde-9f61-7069689d3ea6","vmScaleSetName":"88t8-2025-11-12-ubuntu2204","vmSize":"Standard_D2ads_v6","zone":""},"network":{"interface":[{"ipv4":{"ipAddress":[{"privateIpAddress":"10.224.0.7","publicIpAddress":""}],"subnet":[{"address":"10.224.0.0","prefix":"16"}]},"ipv6":{"ipAddress":[]},"macAddress":"000D3AFE890C"}]}}'
+ should_enforce=
+ echo ''
++ exitStatus=0
++ '[' 0 -eq 0 ']'
++ break
++ '[' false = true ']'
++ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
++ return 0
+ ENABLE_MANAGED_GPU_EXPERIENCE=
+ '[' 0 -ne 0 ']'
+ '[' false = true ']'
+ '[' false = true ']'
+ VALIDATION_ERR=0
+ API_SERVER_CONN_RETRIES=50
+ [[ abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io == *.privatelink.* ]]
+ [[ abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]]
+ API_SERVER_DNS_RETRY_TIMEOUT=300
+ [[ abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io == *.privatelink.* ]]
+ '[' false '!=' true ']'
++ logs_to_events AKS.CSE.apiserverNslookup 'retrycmd_nslookup 1 15 300 abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io'
++ local task=AKS.CSE.apiserverNslookup
++ shift
+++ date +%s%3N
++ local eventsFileName=1762984528117
+++ date '+%F %T.%3N'
++ local 'startTime=2025-11-12 21:55:28.119'
++ retrycmd_nslookup 1 15 300 abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io
++ wait_sleep=1
++ timeout=15
++ total_timeout=300
++ record=abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io
+++ date +%s
++ start_time=1762984528
++ true
++ nslookup -timeout=15 -retry=0 abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io
++ break
+++ date +%s
++ current_time=1762984528
++ echo 'Executed nslookup -timeout=15 -retry=0 abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io for 0 seconds'
++ ret=0
+++ date '+%F %T.%3N'
++ local 'endTime=2025-11-12 21:55:28.209'
+++ jq -n --arg Timestamp '2025-11-12 21:55:28.119' --arg OperationId '2025-11-12 21:55:28.209' --arg Version 1.23 --arg TaskName AKS.CSE.apiserverNslookup --arg EventLevel Informational --arg Message 'Completed: retrycmd_nslookup 1 15 300 abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
++ json_string='{
  "Timestamp": "2025-11-12 21:55:28.119",
  "OperationId": "2025-11-12 21:55:28.209",
  "Version": "1.23",
  "TaskName": "AKS.CSE.apiserverNslookup",
  "EventLevel": "Informational",
  "Message": "Completed: retrycmd_nslookup 1 15 300 abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io",
  "EventPid": "0",
  "EventTid": "0"
}'
++ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
++ echo '{' '"Timestamp":' '"2025-11-12' '21:55:28.119",' '"OperationId":' '"2025-11-12' '21:55:28.209",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.apiserverNslookup",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' retrycmd_nslookup 1 15 300 'abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
++ '[' 0 -ne 0 ']'
+ RES='Server:		169.254.10.10
Address:	169.254.10.10#53

Non-authoritative answer:
Name:	abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io
Address: 20.29.154.62

Executed nslookup -timeout=15 -retry=0 abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io for 0 seconds'
+ STS=0
+ '[' 0 -ne 0 ']'
++ get_ubuntu_release
++ lsb_release -r -s
+ '[' 22.04 = 18.04 ']'
+ logs_to_events AKS.CSE.apiserverCurl 'retrycmd_if_failure 50 1 10 curl -v --cacert /etc/kubernetes/certs/ca.crt https://abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io:443'
+ local task=AKS.CSE.apiserverCurl
+ shift
++ date +%s%3N
+ local eventsFileName=1762984528263
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:28.265'
+ retrycmd_if_failure 50 1 10 curl -v --cacert /etc/kubernetes/certs/ca.crt https://abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io:443
+ _retrycmd_internal 50 1 10 true curl -v --cacert /etc/kubernetes/certs/ca.crt https://abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io:443
+ local retries=50
+ shift
+ local waitSleep=1
+ shift
+ local timeoutVal=10
+ shift
+ local shouldLog=true
+ shift
+ cmdToRun=('curl' '-v' '--cacert' '/etc/kubernetes/certs/ca.crt' 'https://abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io:443')
+ local cmdToRun
+ local exitStatus=0
++ seq 1 50
+ for i in $(seq 1 "$retries")
+ timeout 10 curl -v --cacert /etc/kubernetes/certs/ca.crt https://abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io:443
* Uses proxy env variable NO_PROXY == 'localhost,127.0.0.1,168.63.129.16,169.254.169.254,10.0.0.0/16,agentbaker-agentbaker-e2e-t-8ecadf-c82d8251.hcp.eastus.azmk8s.io'
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 20.29.154.62:443...
* Connected to abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io (20.29.154.62) port 443 (#0)
* ALPN, offering h2
* ALPN, offering http/1.1
*  CAfile: /etc/kubernetes/certs/ca.crt
*  CApath: /etc/ssl/certs
* TLSv1.0 (OUT), TLS header, Certificate Status (22):
} [5 bytes data]
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [512 bytes data]
* TLSv1.2 (IN), TLS header, Certificate Status (22):
{ [5 bytes data]
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [122 bytes data]
* TLSv1.2 (IN), TLS header, Finished (20):
{ [5 bytes data]
* TLSv1.2 (IN), TLS header, Supplemental data (23):
{ [5 bytes data]
* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):
{ [15 bytes data]
* TLSv1.3 (IN), TLS handshake, Request CERT (13):
{ [60 bytes data]
* TLSv1.3 (IN), TLS handshake, Certificate (11):
{ [1552 bytes data]
* TLSv1.3 (IN), TLS handshake, CERT verify (15):
{ [520 bytes data]
* TLSv1.3 (IN), TLS handshake, Finished (20):
{ [52 bytes data]
* TLSv1.2 (OUT), TLS header, Finished (20):
} [5 bytes data]
* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS header, Supplemental data (23):
} [5 bytes data]
* TLSv1.3 (OUT), TLS handshake, Certificate (11):
} [8 bytes data]
* TLSv1.2 (OUT), TLS header, Supplemental data (23):
} [5 bytes data]
* TLSv1.3 (OUT), TLS handshake, Finished (20):
} [52 bytes data]
* SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384
* ALPN, server accepted to use h2
* Server certificate:
*  subject: CN=apiserver
*  start date: Nov 11 01:14:28 2025 GMT
*  expire date: Nov 11 01:24:28 2027 GMT
*  subjectAltName: host "abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io" matched cert's "abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io"
*  issuer: CN=ca
*  SSL certificate verify ok.
* Using HTTP2, server supports multiplexing
* Connection state changed (HTTP/2 confirmed)
* Copying HTTP/2 data in stream buffer to connection buffer after upgrade: len=0
* TLSv1.2 (OUT), TLS header, Supplemental data (23):
} [5 bytes data]
* TLSv1.2 (OUT), TLS header, Supplemental data (23):
} [5 bytes data]
* TLSv1.2 (OUT), TLS header, Supplemental data (23):
} [5 bytes data]
* Using Stream ID: 1 (easy handle 0x5590e54279f0)
* TLSv1.2 (OUT), TLS header, Supplemental data (23):
} [5 bytes data]
> GET / HTTP/2
> Host: abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io
> user-agent: curl/7.81.0
> accept: */*
> 
* TLSv1.2 (IN), TLS header, Supplemental data (23):
{ [5 bytes data]
* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
{ [230 bytes data]
* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
{ [230 bytes data]
* old SSL session ID is stale, removing
* TLSv1.2 (IN), TLS header, Supplemental data (23):
{ [5 bytes data]
* TLSv1.2 (OUT), TLS header, Supplemental data (23):
} [5 bytes data]
* TLSv1.2 (IN), TLS header, Supplemental data (23):
{ [5 bytes data]
* TLSv1.2 (IN), TLS header, Supplemental data (23):
{ [5 bytes data]
< HTTP/2 401 
< audit-id: 4985fb88-b767-4ed8-9130-7662e736db8b
< cache-control: no-cache, private
< content-type: application/json
< content-length: 157
< date: Wed, 12 Nov 2025 21:55:28 GMT
< 
{ [157 bytes data]
100   157  100   157    0     0   9311      0 --:--:-- --:--:-- --:--:--  9812
* Connection #0 to host abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io left intact
{
  "kind": "Status",
  "apiVersion": "v1",
  "metadata": {},
  "status": "Failure",
  "message": "Unauthorized",
  "reason": "Unauthorized",
  "code": 401
}+ exitStatus=0
+ '[' 0 -eq 0 ']'
+ break
+ '[' true = true ']'
+ '[' 0 -eq 0 ']'
+ echo 'Executed "curl -v --cacert /etc/kubernetes/certs/ca.crt https://abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io:443" 1 times.'
Executed "curl -v --cacert /etc/kubernetes/certs/ca.crt https://abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io:443" 1 times.
+ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
+ return 0
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:28.295'
++ jq -n --arg Timestamp '2025-11-12 21:55:28.265' --arg OperationId '2025-11-12 21:55:28.295' --arg Version 1.23 --arg TaskName AKS.CSE.apiserverCurl --arg EventLevel Informational --arg Message 'Completed: retrycmd_if_failure 50 1 10 curl -v --cacert /etc/kubernetes/certs/ca.crt https://abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io:443' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:28.265",
  "OperationId": "2025-11-12 21:55:28.295",
  "Version": "1.23",
  "TaskName": "AKS.CSE.apiserverCurl",
  "EventLevel": "Informational",
  "Message": "Completed: retrycmd_if_failure 50 1 10 curl -v --cacert /etc/kubernetes/certs/ca.crt https://abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io:443",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:28.265",' '"OperationId":' '"2025-11-12' '21:55:28.295",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.apiserverCurl",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' retrycmd_if_failure 50 1 10 curl -v --cacert /etc/kubernetes/certs/ca.crt 'https://abe2e-kubenet-v2-3ekle5md.hcp.westus2.azmk8s.io:443",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ echo 'API server connection check code: 0'
API server connection check code: 0
+ '[' 0 -ne 0 ']'
+ logs_to_events AKS.CSE.ensureKubelet ensureKubelet
+ local task=AKS.CSE.ensureKubelet
+ shift
++ date +%s%3N
+ local eventsFileName=1762984528329
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:28.331'
+ ensureKubelet
+ KUBELET_DEFAULT_FILE=/etc/default/kubelet
+ mkdir -p /etc/default
+ semverCompare 1.32.9 1.29.0
++ cut -d + -f 1
++ cut -d '~' -f 1
++ echo 1.32.9
+ VERSION_A=1.32.9
++ cut -d + -f 1
++ cut -d '~' -f 1
++ echo 1.29.0
+ VERSION_B=1.29.0
+ '[' 1.32.9 = 1.29.0 ']'
++ sort -V
++ echo 1.32.9 1.29.0
++ tr ' ' '\n'
+ sorted='1.29.0
1.32.9'
++ cut '-d
' -f2
++ IFS=
++ echo '1.29.0
1.32.9'
+ highestVersion=1.32.9
+ '[' 1.32.9 = 1.32.9 ']'
+ return 0
+ logs_to_events AKS.CSE.ensureKubelet.setKubeletNodeIPFlag setKubeletNodeIPFlag
+ local task=AKS.CSE.ensureKubelet.setKubeletNodeIPFlag
+ shift
++ date +%s%3N
+ local eventsFileName=1762984528349
++ date '+%F %T.%3N'
+ local 'startTime=2025-11-12 21:55:28.352'
+ setKubeletNodeIPFlag
++ curl -s -H Metadata:true --noproxy '*' --max-time 5 'http://169.254.169.254/metadata/instance/network/interface?api-version=2021-02-01'
+ imdsOutput='[{"ipv4":{"ipAddress":[{"privateIpAddress":"10.224.0.7","publicIpAddress":""}],"subnet":[{"address":"10.224.0.0","prefix":"16"}]},"ipv6":{"ipAddress":[]},"macAddress":"000D3AFE890C"}]'
+ '[' 0 -eq 0 ']'
+ nodeIPAddrs=()
++ jq -r '.[0].ipv4.ipAddress[0].privateIpAddress // ""'
++ echo '[{"ipv4":{"ipAddress":[{"privateIpAddress":"10.224.0.7","publicIpAddress":""}],"subnet":[{"address":"10.224.0.0","prefix":"16"}]},"ipv6":{"ipAddress":[]},"macAddress":"000D3AFE890C"}]'
+ ipv4Addr=10.224.0.7
+ '[' -n 10.224.0.7 ']'
+ nodeIPAddrs+=("$ipv4Addr")
++ jq -r '.[0].ipv6.ipAddress[0].privateIpAddress // ""'
++ echo '[{"ipv4":{"ipAddress":[{"privateIpAddress":"10.224.0.7","publicIpAddress":""}],"subnet":[{"address":"10.224.0.0","prefix":"16"}]},"ipv6":{"ipAddress":[]},"macAddress":"000D3AFE890C"}]'
+ ipv6Addr=
+ '[' -n '' ']'
++ IFS=,
++ echo 10.224.0.7
+ nodeIPArg=10.224.0.7
+ '[' -n 10.224.0.7 ']'
+ echo 'Adding --node-ip=10.224.0.7 to kubelet flags'
Adding --node-ip=10.224.0.7 to kubelet flags
+ KUBELET_FLAGS='--address=0.0.0.0 --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --cgroups-per-qos=true --client-ca-file=/etc/kubernetes/certs/ca.crt --cloud-config= --cloud-provider=external --cluster-dns=10.0.0.10 --cluster-domain=cluster.local --enforce-node-allocatable=pods --event-qps=0 --eviction-hard=memory.available<750Mi,nodefs.available<10%,nodefs.inodesFree<5% --feature-gates=RotateKubeletServerCertificate=true --image-gc-high-threshold=85 --image-gc-low-threshold=80 --kube-reserved=cpu=100m,memory=1638Mi --kubeconfig=/var/lib/kubelet/kubeconfig --max-pods=110 --node-status-update-frequency=10s --pod-infra-container-image=mcr.microsoft.com/oss/v2/kubernetes/pause:3.6 --pod-manifest-path=/etc/kubernetes/manifests --pod-max-pids=-1 --protect-kernel-defaults=true --read-only-port=0 --resolv-conf=/run/systemd/resolve/resolv.conf --rotate-certificates=true --streaming-connection-idle-timeout=4h --tls-cert-file=/etc/kubernetes/certs/kubeletserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --tls-private-key-file=/etc/kubernetes/certs/kubeletserver.key  --node-ip=10.224.0.7'
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:28.428'
++ jq -n --arg Timestamp '2025-11-12 21:55:28.352' --arg OperationId '2025-11-12 21:55:28.428' --arg Version 1.23 --arg TaskName AKS.CSE.ensureKubelet.setKubeletNodeIPFlag --arg EventLevel Informational --arg Message 'Completed: setKubeletNodeIPFlag' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:28.352",
  "OperationId": "2025-11-12 21:55:28.428",
  "Version": "1.23",
  "TaskName": "AKS.CSE.ensureKubelet.setKubeletNodeIPFlag",
  "EventLevel": "Informational",
  "Message": "Completed: setKubeletNodeIPFlag",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
Updating index cache for path `/usr/share/man/man3'. Wait...
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:28.352",' '"OperationId":' '"2025-11-12' '21:55:28.428",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.ensureKubelet.setKubeletNodeIPFlag",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'setKubeletNodeIPFlag",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ semverCompare 1.32.9 1.32.0
Updating index cache for path `/usr/share/man/man1'. Wait...
++ echo 1.32.9
++ cut -d + -f 1
++ cut -d '~' -f 1
+ VERSION_A=1.32.9
++ echo 1.32.0
++ cut -d '~' -f 1
++ cut -d + -f 1
Updating index cache for path `/usr/share/man/man8'. Wait...
+ VERSION_B=1.32.0
+ '[' 1.32.9 = 1.32.0 ']'
++ echo 1.32.9 1.32.0
Updating index cache for path `/usr/share/man/man7'. Wait...
++ tr ' ' '\n'
++ sort -V
done.
+ sorted='1.32.0
1.32.9'
++ IFS=
++ echo '1.32.0
1.32.9'
++ cut '-d
' -f2
+ highestVersion=1.32.9
+ '[' 1.32.9 = 1.32.9 ']'
+ return 0
+ tee /etc/systemd/system/kubelet.service.d/10-watchdog.conf
+ echo 'KUBELET_FLAGS=--address=0.0.0.0 --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --cgroups-per-qos=true --client-ca-file=/etc/kubernetes/certs/ca.crt --cloud-config= --cloud-provider=external --cluster-dns=10.0.0.10 --cluster-domain=cluster.local --enforce-node-allocatable=pods --event-qps=0 --eviction-hard=memory.available<750Mi,nodefs.available<10%,nodefs.inodesFree<5% --feature-gates=RotateKubeletServerCertificate=true --image-gc-high-threshold=85 --image-gc-low-threshold=80 --kube-reserved=cpu=100m,memory=1638Mi --kubeconfig=/var/lib/kubelet/kubeconfig --max-pods=110 --node-status-update-frequency=10s --pod-infra-container-image=mcr.microsoft.com/oss/v2/kubernetes/pause:3.6 --pod-manifest-path=/etc/kubernetes/manifests --pod-max-pids=-1 --protect-kernel-defaults=true --read-only-port=0 --resolv-conf=/run/systemd/resolve/resolv.conf --rotate-certificates=true --streaming-connection-idle-timeout=4h --tls-cert-file=/etc/kubernetes/certs/kubeletserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --tls-private-key-file=/etc/kubernetes/certs/kubeletserver.key  --node-ip=10.224.0.7'
+ echo KUBELET_REGISTER_SCHEDULABLE=true
+ echo NETWORK_POLICY=
+ echo KUBELET_IMAGE=
+ echo KUBELET_NODE_LABELS=agentpool=nodepool2,kubernetes.azure.com/agentpool=nodepool2,kubernetes.azure.com/cluster=test-cluster,kubernetes.azure.com/mode=system,kubernetes.azure.com/node-image-version=AKSUbuntu-1804gen2containerd-2022.01.19
+ '[' -n '' ']'
+ chmod 0600 /etc/default/kubelet
+ BOOTSTRAP_KUBECONFIG_FILE=/var/lib/kubelet/bootstrap-kubeconfig
+ set +x
using bootstrap token to generate a bootstrap-kubeconfig
+ KUBELET_RUNTIME_CONFIG_SCRIPT_FILE=/opt/azure/containers/kubelet.sh
+ tee /opt/azure/containers/kubelet.sh
++ logs_to_events AKS.CSE.ensureKubelet.getPrimaryNicIP getPrimaryNicIP
++ local task=AKS.CSE.ensureKubelet.getPrimaryNicIP
++ shift
+++ date +%s%3N
++ local eventsFileName=1762984528567
+++ date '+%F %T.%3N'
++ local 'startTime=2025-11-12 21:55:28.569'
++ getPrimaryNicIP
++ local sleepTime=1
++ local maxRetries=10
++ local i=0
++ local ip=
++ '[' 0 -lt 10 ']'
+++ curl -sSL -H 'Metadata: true' 'http://169.254.169.254/metadata/instance/network/interface?api-version=2021-02-01'
++ ip='[{"ipv4":{"ipAddress":[{"privateIpAddress":"10.224.0.7","publicIpAddress":""}],"subnet":[{"address":"10.224.0.0","prefix":"16"}]},"ipv6":{"ipAddress":[]},"macAddress":"000D3AFE890C"}]'
++ '[' 0 -eq 0 ']'
+++ jq -r '.[0].ipv4.ipAddress[0].privateIpAddress'
+++ echo '[{"ipv4":{"ipAddress":[{"privateIpAddress":"10.224.0.7","publicIpAddress":""}],"subnet":[{"address":"10.224.0.0","prefix":"16"}]},"ipv6":{"ipAddress":[]},"macAddress":"000D3AFE890C"}]'
++ ip=10.224.0.7
++ '[' -n 10.224.0.7 ']'
++ break
++ echo 10.224.0.7
++ ret=0
+++ date '+%F %T.%3N'
++ local 'endTime=2025-11-12 21:55:28.605'
+++ jq -n --arg Timestamp '2025-11-12 21:55:28.569' --arg OperationId '2025-11-12 21:55:28.605' --arg Version 1.23 --arg TaskName AKS.CSE.ensureKubelet.getPrimaryNicIP --arg EventLevel Informational --arg Message 'Completed: getPrimaryNicIP' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
++ json_string='{
  "Timestamp": "2025-11-12 21:55:28.569",
  "OperationId": "2025-11-12 21:55:28.605",
  "Version": "1.23",
  "TaskName": "AKS.CSE.ensureKubelet.getPrimaryNicIP",
  "EventLevel": "Informational",
  "Message": "Completed: getPrimaryNicIP",
  "EventPid": "0",
  "EventTid": "0"
}'
++ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
++ echo '{' '"Timestamp":' '"2025-11-12' '21:55:28.569",' '"OperationId":' '"2025-11-12' '21:55:28.605",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.ensureKubelet.getPrimaryNicIP",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'getPrimaryNicIP",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
++ '[' 0 -ne 0 ']'
+ primaryNicIP=10.224.0.7
+ ENSURE_IMDS_RESTRICTION_DROP_IN=/etc/systemd/system/kubelet.service.d/10-ensure-imds-restriction.conf
++ dirname /etc/systemd/system/kubelet.service.d/10-ensure-imds-restriction.conf
+ mkdir -p /etc/systemd/system/kubelet.service.d
+ touch /etc/systemd/system/kubelet.service.d/10-ensure-imds-restriction.conf
+ chmod 0600 /etc/systemd/system/kubelet.service.d/10-ensure-imds-restriction.conf
+ tee /etc/systemd/system/kubelet.service.d/10-ensure-imds-restriction.conf
+ [[ --address=0.0.0.0 --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --cgroups-per-qos=true --client-ca-file=/etc/kubernetes/certs/ca.crt --cloud-config= --cloud-provider=external --cluster-dns=10.0.0.10 --cluster-domain=cluster.local --enforce-node-allocatable=pods --event-qps=0 --eviction-hard=memory.available<750Mi,nodefs.available<10%,nodefs.inodesFree<5% --feature-gates=RotateKubeletServerCertificate=true --image-gc-high-threshold=85 --image-gc-low-threshold=80 --kube-reserved=cpu=100m,memory=1638Mi --kubeconfig=/var/lib/kubelet/kubeconfig --max-pods=110 --node-status-update-frequency=10s --pod-infra-container-image=mcr.microsoft.com/oss/v2/kubernetes/pause:3.6 --pod-manifest-path=/etc/kubernetes/manifests --pod-max-pids=-1 --protect-kernel-defaults=true --read-only-port=0 --resolv-conf=/run/systemd/resolve/resolv.conf --rotate-certificates=true --streaming-connection-idle-timeout=4h --tls-cert-file=/etc/kubernetes/certs/kubeletserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --tls-private-key-file=/etc/kubernetes/certs/kubeletserver.key  --node-ip=10.224.0.7 == *\i\m\a\g\e\-\c\r\e\d\e\n\t\i\a\l\-\p\r\o\v\i\d\e\r\-\c\o\n\f\i\g* ]]
+ '[' -n '' ']'
+ systemctlEnableAndStartNoBlock measure-tls-bootstrapping-latency 30
+ service=measure-tls-bootstrapping-latency
+ timeout=30
+ status_check_delay_seconds=0
+ systemctl_restart_no_block 100 5 30 measure-tls-bootstrapping-latency
+ _systemctl_retry_svc_operation 100 5 30 'restart --no-block' measure-tls-bootstrapping-latency true
+ retries=100
+ wait_sleep=5
+ timeout=30
+ operation='restart --no-block'
+ svcname=measure-tls-bootstrapping-latency
+ shouldLogRetryInfo=true
++ seq 1 100
+ for i in $(seq 1 $retries)
+ timeout 30 systemctl daemon-reload
+ timeout 30 systemctl restart --no-block measure-tls-bootstrapping-latency
+ break
+ RESTART_STATUS=0
+ '[' 0 -ne 0 ']'
+ retrycmd_if_failure 120 5 25 systemctl enable measure-tls-bootstrapping-latency
+ _retrycmd_internal 120 5 25 true systemctl enable measure-tls-bootstrapping-latency
+ local retries=120
+ shift
+ local waitSleep=5
+ shift
+ local timeoutVal=25
+ shift
+ local shouldLog=true
+ shift
+ cmdToRun=('systemctl' 'enable' 'measure-tls-bootstrapping-latency')
+ local cmdToRun
+ local exitStatus=0
++ seq 1 120
+ for i in $(seq 1 "$retries")
+ timeout 25 systemctl enable measure-tls-bootstrapping-latency
Created symlink /etc/systemd/system/multi-user.target.wants/measure-tls-bootstrapping-latency.service  /etc/systemd/system/measure-tls-bootstrapping-latency.service.
+ exitStatus=0
+ '[' 0 -eq 0 ']'
+ break
+ '[' true = true ']'
+ '[' 0 -eq 0 ']'
+ echo 'Executed "systemctl enable measure-tls-bootstrapping-latency" 1 times.'
Executed "systemctl enable measure-tls-bootstrapping-latency" 1 times.
+ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
+ return 0
+ sleep 0
+ systemctl is-failed measure-tls-bootstrapping-latency
activating
+ systemctl status measure-tls-bootstrapping-latency --no-pager -l
+ echo 'measure-tls-bootstrapping-latency is still activating, continuing anyway...'
measure-tls-bootstrapping-latency is still activating, continuing anyway...
+ systemctlEnableAndStartNoBlock kubelet 240
+ service=kubelet
+ timeout=240
+ status_check_delay_seconds=0
+ systemctl_restart_no_block 100 5 240 kubelet
+ _systemctl_retry_svc_operation 100 5 240 'restart --no-block' kubelet true
+ retries=100
+ wait_sleep=5
+ timeout=240
+ operation='restart --no-block'
+ svcname=kubelet
+ shouldLogRetryInfo=true
++ seq 1 100
+ for i in $(seq 1 $retries)
+ timeout 240 systemctl daemon-reload
+ timeout 240 systemctl restart --no-block kubelet
+ break
+ RESTART_STATUS=0
+ '[' 0 -ne 0 ']'
+ retrycmd_if_failure 120 5 25 systemctl enable kubelet
+ _retrycmd_internal 120 5 25 true systemctl enable kubelet
+ local retries=120
+ shift
+ local waitSleep=5
+ shift
+ local timeoutVal=25
+ shift
+ local shouldLog=true
+ shift
+ cmdToRun=('systemctl' 'enable' 'kubelet')
+ local cmdToRun
+ local exitStatus=0
++ seq 1 120
+ for i in $(seq 1 "$retries")
+ timeout 25 systemctl enable kubelet
Created symlink /etc/systemd/system/multi-user.target.wants/kubelet.service  /etc/systemd/system/kubelet.service.
+ exitStatus=0
+ '[' 0 -eq 0 ']'
+ break
+ '[' true = true ']'
+ '[' 0 -eq 0 ']'
+ echo 'Executed "systemctl enable kubelet" 1 times.'
Executed "systemctl enable kubelet" 1 times.
+ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
+ return 0
+ sleep 0
+ systemctl is-failed kubelet
activating
+ systemctl status kubelet --no-pager -l
+ echo 'kubelet is still activating, continuing anyway...'
kubelet is still activating, continuing anyway...
+ ret=0
++ date '+%F %T.%3N'
+ local 'endTime=2025-11-12 21:55:30.099'
++ jq -n --arg Timestamp '2025-11-12 21:55:28.331' --arg OperationId '2025-11-12 21:55:30.099' --arg Version 1.23 --arg TaskName AKS.CSE.ensureKubelet --arg EventLevel Informational --arg Message 'Completed: ensureKubelet' --arg EventPid 0 --arg EventTid 0 '{Timestamp: $Timestamp, OperationId: $OperationId, Version: $Version, TaskName: $TaskName, EventLevel: $EventLevel, Message: $Message, EventPid: $EventPid, EventTid: $EventTid}'
+ json_string='{
  "Timestamp": "2025-11-12 21:55:28.331",
  "OperationId": "2025-11-12 21:55:30.099",
  "Version": "1.23",
  "TaskName": "AKS.CSE.ensureKubelet",
  "EventLevel": "Informational",
  "Message": "Completed: ensureKubelet",
  "EventPid": "0",
  "EventTid": "0"
}'
+ mkdir -p /var/log/azure/Microsoft.Azure.Extensions.CustomScript/events/
+ echo '{' '"Timestamp":' '"2025-11-12' '21:55:28.331",' '"OperationId":' '"2025-11-12' '21:55:30.099",' '"Version":' '"1.23",' '"TaskName":' '"AKS.CSE.ensureKubelet",' '"EventLevel":' '"Informational",' '"Message":' '"Completed:' 'ensureKubelet",' '"EventPid":' '"0",' '"EventTid":' '"0"' '}'
+ '[' 0 -ne 0 ']'
+ false
+ '[' UBUNTU = UBUNTU ']'
+ '[' false = true ']'
+ echo 'Custom script finished.'
Custom script finished.
++ date
+ aptmarkWALinuxAgent unhold
++ hostname
+ echo Wed Nov 12 21:55:30 UTC 2025,88t8-2025-11-12-ubuntu2204000000, endcustomscript
++ date
++ hostname
+ echo Wed Nov 12 21:55:30 UTC 2025,88t8-2025-11-12-ubuntu2204000000, startAptmarkWALinuxAgent unhold
Wed Nov 12 21:55:30 UTC 2025,88t8-2025-11-12-ubuntu2204000000, startAptmarkWALinuxAgent unhold
+ wait_for_apt_locks
+ fuser /var/lib/dpkg/lock /var/lib/apt/lists/lock /var/cache/apt/archives/lock /var/lib/dpkg/lock-frontend
+ retrycmd_if_failure 120 5 25 apt-mark unhold walinuxagent
+ _retrycmd_internal 120 5 25 true apt-mark unhold walinuxagent
+ local retries=120
+ shift
+ local waitSleep=5
+ shift
+ local timeoutVal=25
+ shift
+ local shouldLog=true
+ shift
+ cmdToRun=('apt-mark' 'unhold' 'walinuxagent')
+ local cmdToRun
+ local exitStatus=0
++ seq 1 120
+ for i in $(seq 1 "$retries")
+ timeout 25 apt-mark unhold walinuxagent
Canceled hold on walinuxagent.
+ exitStatus=0
+ '[' 0 -eq 0 ']'
+ break
+ '[' true = true ']'
+ '[' 0 -eq 0 ']'
+ echo 'Executed "apt-mark unhold walinuxagent" 1 times.'
Executed "apt-mark unhold walinuxagent" 1 times.
+ RETRYCMD_INTERNAL_LAST_EXIT_STATUS=0
+ return 0
++ date
++ hostname
+ echo Wed Nov 12 21:55:30 UTC 2025,88t8-2025-11-12-ubuntu2204000000, endAptmarkWALinuxAgent unhold
Wed Nov 12 21:55:30 UTC 2025,88t8-2025-11-12-ubuntu2204000000, endAptmarkWALinuxAgent unhold
Purging old database entries in /usr/share/man...
Processing manual pages under /usr/share/man...
Checking for stray cats under /usr/share/man...
Checking for stray cats under /var/cache/man...
Purging old database entries in /usr/share/man/sl...
Processing manual pages under /usr/share/man/sl...
Purging old database entries in /usr/share/man/fi...
Processing manual pages under /usr/share/man/fi...
Purging old database entries in /usr/share/man/da...
Processing manual pages under /usr/share/man/da...
Purging old database entries in /usr/share/man/id...
Processing manual pages under /usr/share/man/id...
Purging old database entries in /usr/share/man/cs...
Processing manual pages under /usr/share/man/cs...
Purging old database entries in /usr/share/man/uk...
Processing manual pages under /usr/share/man/uk...
Purging old database entries in /usr/share/man/fr...
Processing manual pages under /usr/share/man/fr...
Purging old database entries in /usr/share/man/zh_CN...
Processing manual pages under /usr/share/man/zh_CN...
Purging old database entries in /usr/share/man/sv...
Processing manual pages under /usr/share/man/sv...
Purging old database entries in /usr/share/man/es...
Processing manual pages under /usr/share/man/es...
Purging old database entries in /usr/share/man/hu...
Processing manual pages under /usr/share/man/hu...
Purging old database entries in /usr/share/man/ro...
Processing manual pages under /usr/share/man/ro...
Purging old database entries in /usr/share/man/pt...
Processing manual pages under /usr/share/man/pt...
Purging old database entries in /usr/share/man/pl...
Processing manual pages under /usr/share/man/pl...
Purging old database entries in /usr/share/man/ja...
Processing manual pages under /usr/share/man/ja...
Purging old database entries in /usr/share/man/it...
Processing manual pages under /usr/share/man/it...
Purging old database entries in /usr/share/man/zh_TW...
Processing manual pages under /usr/share/man/zh_TW...
Purging old database entries in /usr/share/man/tr...
Processing manual pages under /usr/share/man/tr...
Purging old database entries in /usr/share/man/nl...
Processing manual pages under /usr/share/man/nl...
Purging old database entries in /usr/share/man/ru...
Processing manual pages under /usr/share/man/ru...
Purging old database entries in /usr/share/man/sr...
Processing manual pages under /usr/share/man/sr...
Purging old database entries in /usr/share/man/de...
Processing manual pages under /usr/share/man/de...
Purging old database entries in /usr/share/man/pt_BR...
Processing manual pages under /usr/share/man/pt_BR...
Purging old database entries in /usr/share/man/ko...
Processing manual pages under /usr/share/man/ko...
Processing manual pages under /usr/local/man...
/usr/bin/mandb: can't update index cache /var/cache/man/oldlocal/3487: No such file or directory
4 man subdirectories contained newer manual pages.
0 manual pages were added.
0 stray cats were added.
639 old database entries were purged.
++ date
+ echo 'man-db finished updates at Wed Nov 12 21:55:30 UTC 2025'
man-db finished updates at Wed Nov 12 21:55:30 UTC 2025

----------------------------------- end stdout ------------------------------------
